(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{458:function(e,s,a){"use strict";a.r(s);var t=a(6),n=Object(t.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("blockquote",[a("p",[e._v("本文由 "),a("a",{attrs:{href:"http://ksria.com/simpread/",target:"_blank",rel:"noopener noreferrer"}},[e._v("简悦 SimpRead"),a("OutboundLink")],1),e._v(" 转码， 原文地址 https://blog.yangmame.org/%E5%9C%A8U%E7%9B%98%E5%AE%89%E8%A3%85%E5%8A%A0%E5%AF%86%E7%9A%84Linux%E7%B3%BB%E7%BB%9F.html")])]),e._v(" "),a("h1",{attrs:{id:"适用场景：外出需要电脑，却没有携带自己的电脑，且不能信任能找到的电脑的环境；不想在外泄漏隐身；不是自己想使用的系统-环境。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#适用场景：外出需要电脑，却没有携带自己的电脑，且不能信任能找到的电脑的环境；不想在外泄漏隐身；不是自己想使用的系统-环境。"}},[e._v("#")]),e._v(" 适用场景：外出需要电脑，却没有携带自己的电脑，且不能信任能找到的电脑的环境；不想在外泄漏隐身；不是自己想使用的系统 / 环境。")]),e._v(" "),a("h1",{attrs:{id:"教程目标：制作一个可以保留更改的运行-linux-的-u-盘，加密根目录-boot-除外-，开机可以选择-ramroot-模式启动-将整个-linux-系统加载在内存，适合在大内存机器且不想保留更改时使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#教程目标：制作一个可以保留更改的运行-linux-的-u-盘，加密根目录-boot-除外-，开机可以选择-ramroot-模式启动-将整个-linux-系统加载在内存，适合在大内存机器且不想保留更改时使用"}},[e._v("#")]),e._v(" 教程目标：制作一个可以保留更改的运行 Linux 的 U 盘，加密根目录 (boot 除外)，开机可以选择 ramroot 模式启动 (将整个 Linux 系统加载在内存，适合在大内存机器且不想保留更改时使用)")]),e._v(" "),a("h1",{attrs:{id:"需要的东西："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#需要的东西："}},[e._v("#")]),e._v(" 需要的东西：")]),e._v(" "),a("ul",[a("li",[e._v("一个正常运行的 Arch Linux")]),e._v(" "),a("li",[e._v("一个 U 盘（推荐 3.1，3.0 和 2.0 可能体验较差）")])]),e._v(" "),a("h1",{attrs:{id:"需要用到的软件-命令："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#需要用到的软件-命令："}},[e._v("#")]),e._v(" 需要用到的软件 / 命令：")]),e._v(" "),a("ul",[a("li",[e._v("cryptsetup")]),e._v(" "),a("li",[e._v("arch-install-scripts(可以直接通过 pacman 安装）")])]),e._v(" "),a("h1",{attrs:{id:"开始"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开始"}},[e._v("#")]),e._v(" 开始")]),e._v(" "),a("p",[e._v("以下过程默认在 root 用户下运行")]),e._v(" "),a("h2",{attrs:{id:"配置分区"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置分区"}},[e._v("#")]),e._v(" 配置分区")]),e._v(" "),a("p",[e._v("这里就简单说下如何分区，至于用什么工具分区随你喜欢")]),e._v(" "),a("p",[e._v("这里的 / dev/sdb 将在之后的教程当作 U 盘使用（请自己注意更换)")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("分区类型：dos，以下分区皆为主分区(primary）\n分区--------\x3e挂载点--\x3e大小---\x3e类型\n/dev/sdb1---\x3e/boot---\x3e128M---\x3eEFI Filesystem(需要设置为可启动(bootable)）\n/dev/sdb2---\x3e/-------\x3eFree---\x3eLinux\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])]),a("p",[e._v("创建加密 LUKS(需要输入大写 yes 然后输入你的密码 / 口令)：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("cryptsetup --verbose --cipher aes-xts-plain64 --key-size 512 --hash sha512 --iter-time 5000 --use-random luksFormat /dev/sdb2\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("打开 LUKS(需要输入密码 / 口令)：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("cryptsetup open --type luks /dev/sdb2 cryptroot\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("格式化：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("mkfs -t vfat -F 32 /dev/sdb1\nmkfs -i 8192 -t ext4 /dev/mapper/cryptroot\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("挂载分区：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("mount -t ext4 /dev/mapper/cryptroot /mnt\nmkdir -p /mnt/boot\nmount -t ext4 /dev/sdb1 /mnt/boot\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("h2",{attrs:{id:"安装系统"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装系统"}},[e._v("#")]),e._v(" 安装系统")]),e._v(" "),a("p",[e._v("如果你在使用 Arch Linux 的 Live CD 安装，你可能需要修改"),a("code",[e._v("/etc/pacman.d/mirrorlist")]),e._v("选择镜像站")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("pacstrap -i /mnt base base-devel\ngenfstab -U -p /mnt >> /mnt/etc/fstab\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("进入 chroot 环境：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("arch-chroot /mnt\nsource /etc/profile\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("配置 locale:")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('TMP="en_US.UTF-8" # 将这里改为你想使用的语言（建议en）\necho "${TMP} UTF-8" > /etc/locale.gen\nlocale-gen\necho LANG=${TMP} > /etc/locale.conf\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])]),a("p",[e._v("至于时区这里示例使用中国时区：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\nhwclock --systohc --utc\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("更改 root 密码与主机名：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("passwd\necho Live > /etc/hostname\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("编辑"),a("code",[e._v("/etc/mkinitcpio.conf")]),e._v("在"),a("code",[e._v("HOOKS")]),e._v("中加入"),a("code",[e._v("keyboard")]),e._v(" "),a("code",[e._v("keymap")]),e._v(" "),a("code",[e._v("encrypt")]),e._v("以支持加密（需要注意顺序）：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 示例\nHOOKS=(base udev autodetect keyboard keymap consolefont modconf block encrypt filesystems fsck)\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("添加 ramroot 支持：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("pacman -S git\ngit clone https://github.com/arcmags/ramroot\ncd ramroot\n./ramroot enable\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])]),a("p",[e._v("重新生成 initramfs：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("mkinitcpio -p linux\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("安装引导:")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("pacman -S grub efibootmgr\ngrub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=BOOT # 这里会有非GPT报错可以忽略\nmv /boot/EFI/BOOT/grubx64.efi /boot/EFI/BOOT/BOOTX64.efi\ngrub-install --target=i386-pc /dev/sdb\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])]),a("p",[e._v("另开终端运行"),a("code",[e._v("blkid")]),e._v("复制"),a("code",[e._v("/dev/sdb2")]),e._v("的 UUID（注意不要和"),a("code",[e._v("/dev/mapper/cryptroot")]),e._v("的 UUID 混淆）")]),e._v(" "),a("p",[e._v("回到原终端编辑"),a("code",[e._v("/etc/default/grub")]),e._v("在"),a("code",[e._v('GRUB_CMDLINE_LINUX=""')]),e._v("加入：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("cryptdevice=UUID=这里换成刚刚复制的UUID:cryptroot root=/dev/mapper/cryptroot\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("生成"),a("code",[e._v("grub.cfg")]),e._v(":")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("grub-mkconfig -o /boot/grub/grub.cfg\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("安装网络管理器：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 这里建议使用connman或networkmanager\npacman -S connman bluez wpa_supplicant\nsystemctl enable connman\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[e._v("到了这里 你就可以重启看看能不能启动了")]),e._v(" "),a("h1",{attrs:{id:"结尾"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#结尾"}},[e._v("#")]),e._v(" 结尾")]),e._v(" "),a("p",[e._v("最后无非是做一些自己的配置，这里就不多说了，就说说一些建议")]),e._v(" "),a("p",[e._v("安装配置完成之后，根目录使用空间不大或内存够用的话 建议使用 ramroot 启动，启动之后你就可以拔掉 U 盘了（这样启动不会保留对根目录的更改）。")]),e._v(" "),a("p",[e._v("关于分区，这里只简单的分了个 boot 与根分区，其实如果考虑安全性应该再分个 / home 或 / data，默认不挂载，这样使用 ramroot 启动时可以保证数据隐私安全（所以建议新建俩个用户），正常启动时可以手动挂载以保存 / 访问数据。至于怎么玩随你喜欢了。")])])}),[],!1,null,null,null);s.default=n.exports}}]);