(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{448:function(s,e,t){"use strict";t.r(e);var a=t(6),n=Object(a.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"ssh远程连接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ssh远程连接"}},[s._v("#")]),s._v(" ssh远程连接")]),s._v(" "),t("p",[s._v("The authenticity of host '192.168.61.5 (192.168.61.5)' can't be established.\nECDSA key fingerprint is SHA256:IxCNtxCKkA6V1yjRPJd+PQ6YTOXPHuEG+CP2tWe3fAc.\nAre you sure you want to continue connecting (yes/no)? yes\nWarning: Permanently added '192.168.61.5' (ECDSA) to the list of known hosts.")]),s._v(" "),t("p",[s._v("[toc]")]),s._v(" "),t("h2",{attrs:{id:"远程连接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#远程连接"}},[s._v("#")]),s._v(" 远程连接")]),s._v(" "),t("p",[t("code",[s._v("ssh username@hostname")]),s._v("or"),t("code",[s._v("ssh username@ip_address")])]),s._v(" "),t("p",[t("code",[s._v("vnc")])]),s._v(" "),t("h2",{attrs:{id:"远程传输"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#远程传输"}},[s._v("#")]),s._v(" 远程传输")]),s._v(" "),t("h3",{attrs:{id:"scp"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#scp"}},[s._v("#")]),s._v(" scp")]),s._v(" "),t("p",[t("code",[s._v("scp usera@host1:/from/file userb@host2:/to/")])]),s._v(" "),t("p",[t("code",[s._v("scp -r usera@host1:/from/directory userb@host2:/to/")])]),s._v(" "),t("p",[s._v("[toc]")]),s._v(" "),t("h2",{attrs:{id:"ssh远程连接-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ssh远程连接-2"}},[s._v("#")]),s._v(" ssh远程连接")]),s._v(" "),t("h3",{attrs:{id:"机理介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#机理介绍"}},[s._v("#")]),s._v(" 机理介绍")]),s._v(" "),t("blockquote",[t("p",[s._v("http://www.ruanyifeng.com/blog/2011/12/ssh_remote_login.html")])]),s._v(" "),t("blockquote",[t("p",[s._v("http://www.ruanyifeng.com/blog/2011/12/ssh_remote_login.html")])]),s._v(" "),t("blockquote",[t("p",[t("a",{attrs:{href:"http://man.linuxde.net/ssh",target:"_blank",rel:"noopener noreferrer"}},[s._v("ssh命令"),t("OutboundLink")],1)])]),s._v(" "),t("h3",{attrs:{id:"server"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#server"}},[s._v("#")]),s._v(" Server")]),s._v(" "),t("h4",{attrs:{id:"安装启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装启动"}},[s._v("#")]),s._v(" 安装启动")]),s._v(" "),t("p",[s._v("1、彻底卸载ssh服务")]),s._v(" "),t("p",[t("code",[s._v("apt-get purge openssh-server")])]),s._v(" "),t("p",[s._v("2、安装SSH服务\n"),t("code",[s._v("sudo apt-get install openssh-server")])]),s._v(" "),t("p",[s._v("输入以下命令系统会自动进行ssh服务的安装。")]),s._v(" "),t("p",[s._v("3、查看ssh安装情况\n"),t("code",[s._v("dpkg -l |grep ssh")])]),s._v(" "),t("p",[s._v("4、启动OpenSSH服务")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("通过OpenSSH服务器的启动脚本文件启动OpenSSH服务\n"),t("code",[s._v("sudo /etc/init.d/ssh start")])])]),s._v(" "),t("li",[t("p",[s._v("使用Linux下的service命令启动OpenSSH服务\n"),t("code",[s._v("[root@localhost ~]#service sshd start")])])])]),s._v(" "),t("p",[s._v("5、启动后，可以通过如下命令查看服务是否正确启动")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("ps -e|grep ssh   \n6212 ?        00:00:00 sshd  \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("6、重启OpenSSH服务")]),s._v(" "),t("p",[s._v("（1）通过OpenSSH服务器的脚本文件“/etc/rc.d/init.d/sshd”重启OpenSSH服务，命令执行如下。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[root@localhost ~]# /etc/rc.d/init.d/sshd restart\n停止sshd:                        [确定]\n启动sshd:                        [确定]\n[root@localhost ~]#\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("命令执行后，OpenSSH服务自动停止并再次启动。")]),s._v(" "),t("p",[s._v("（2）使用service命令重启OpenSSH服务，命令执行如下。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[root@localhost ~]#service sshd restart\n停止 sshd:                   [确定]\n启动 sshd:                   [确定]\n[root@localhost ~]#\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("命令执行后，OpenSSH服务自动停止并再次启动。")]),s._v(" "),t("p",[s._v("7、停止OpenSSH服务")]),s._v(" "),t("p",[s._v("（1）通过OpenSSH服务器的脚本文件“/etc/rc.d/init.d/sshd”停止OpenSSH服务，命令执行如下。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[root@localhost ~]# /etc/rc.d/init.d/sshd stop\n停止sshd:                        [确定]\n[root@localhost ~]#\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("命令执行后，OpenSSH服务停止运行。")]),s._v(" "),t("p",[s._v("（2）使用service命令停止OpenSSH服务，命令执行如下。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[root@localhost ~]#service sshd stop\n停止 sshd:                   [确定]\n[root@localhost ~]#\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("命令执行后，OpenSSH服务停止运行。")]),s._v(" "),t("p",[s._v("提示：OpenSSH服务的启动和停止方法、格式都是一样的，只不过使用的命令不同，比如：停止用stop,启动用start。")]),s._v(" "),t("h4",{attrs:{id:"用户管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#用户管理"}},[s._v("#")]),s._v(" 用户管理")]),s._v(" "),t("p",[s._v("启动完成之后可以修改ssh的配置\n"),t("code",[s._v("gedit /etc/ssh/sshd_config")])]),s._v(" "),t("p",[s._v("输入命令whoami即可知道当前用户")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# whoami\nroot\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("输入命令passwd，输入原密码即可修改密码")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[root@马赛克~]# passwd\nChanging password for user root.\nNew password: \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"add-部分错误和解决办法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#add-部分错误和解决办法"}},[s._v("#")]),s._v(" ADD:部分错误和解决办法")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("PS1：第一次连接需要输入通行密码，以后就不需要再输入通行密码了。少了输入SSH的帐号密码，是不是更安全些呢？")])]),s._v(" "),t("li",[t("p",[s._v("PS2：再限制IP访问SSH，服务器会更安全些。")])])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v(" vi /etc/hosts.allow\nsshd:172.16.X.X:allow   #在最后一行写入172.16.X.X/172.16.0(段)\n\nvi /etc/hosts.deny\nsshd:ALL \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("PS3：假设要删除公钥，在SECURECRT连接的时候不要选中公钥，然后进入SSH的配置文件修改如下：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("1、注释#AuthorizedKeysFile     %h/.ssh/authorized_keys\n2、PasswordAuthentication yes\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("PS4：使用SecureCRT连接时提示：unable to authenticate using any of the configured authentication methods")])]),s._v(" "),t("p",[s._v("解决：PasswordAuthentication yes")]),s._v(" "),t("ul",[t("li",[s._v("PS5：用ssh -v去连有问题的服务器，会有比较详细的调试信息在屏幕上输出，可以帮助判断是哪一步出了问题。\n"),t("ul",[t("li",[s._v("提示路径不正确??用root身份登陆服务器:")])])])]),s._v(" "),t("h2",{attrs:{id:"ssh建立socks代理原理浅析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ssh建立socks代理原理浅析"}},[s._v("#")]),s._v(" ssh建立socks代理原理浅析")]),s._v(" "),t("p",[s._v("直入正题，先来一条命令：\n"),t("code",[s._v("ssh -N -D 9000 -f root@host.com")]),s._v("\n属性解释一下：")]),s._v(" "),t("p",[s._v("-D\n这个属性很神奇，关键的那句话是“and the application protocol is then used to determine where to connect to from the remote machine”，翻译为”接下来应用程序协议就会决定去连哪”，应用程序协议指的是TCP/UDP。\n它不仅仅是简单端口转发，当数据到达服务器端的这个端口后，ssh会尝试解析这个请求，并进行TCP或者UDP请求（当然也就包括http请求），将得来的结果从这个端口再回发到客户端。")]),s._v(" "),t("p",[s._v("9000\n代表指定本地的socks代理端口。")]),s._v(" "),t("p",[s._v("root@host.com\n这是ssh标准常用命令~ 指定socks服务器在哪，但这不代表监听就一定开在服务器，这取决于这条命令在哪执行。")]),s._v(" "),t("p",[s._v("-N\n这是个辅助属性，一般ssh连好以后就进入shell，可以让你打命令了，我只要做端口转发，所以我不需要执行命令。")]),s._v(" "),t("p",[s._v("-f\n这同样是个辅助属性，如果没有它，只有-D和-N，那么这个进程会在前台运行，阻塞后续操作，现象就是一个光标不停地在闪。用了它当前ssh进程就进后台运行了。")]),s._v(" "),t("p",[s._v("总结：")]),s._v(" "),t("p",[s._v("如果在服务器上执行这条命令，譬如 "),t("code",[s._v("ssh -N -D 9000 -f root@localhost")]),s._v("，那么服务器就开好socks监听端口了。")]),s._v(" "),t("p",[s._v("那么这个端口转发可以被其他机器使用么？比如通过其他客户端来直接连接 服务器 的 9000 端口？答案是不行的，在主流 SSH 实现中，本地端口转发绑定的是 lookback 接口，这意味着只有 localhost 或者 127.0.0.1 才能使用本机的端口转发 , 其他机器发起的连接只会得到“ connection refused. ”。好在 SSH 同时提供了 GatewayPorts 关键字，我们可以通过指定它与其他机器共享这个本地端口转发。")]),s._v(" "),t("p",[t("code",[s._v("ssh-g -N -D 9000 -f root@host.com")])]),s._v(" "),t("p",[s._v("如果在客户机上执行，远程连root@remotehost，那么相当于在本地开了一个socks代理监听，socks服务器就是本机，但通过remotehost来处理请求。")]),s._v(" "),t("p",[s._v("网上有很多翻墙教程说要一个myentunnel通过ssh实现本地socks代理，其实如果你自己有ssh的vps，执行命令的权限，直接在远程主机上执行就开好socks代理了，那么这软件也不用运行了。")]),s._v(" "),t("p",[s._v("SSH是一种通讯协议，可以实现远程安全登录。可以通过如putty、MobaXterm等工具通过ssh安全登录到虚拟机进行操作。\nOpenssh：ssh远程安全登录的开源实现（软件）。\n一、SSH远程登录的原理（基于口令）\n1、客户端向服务器发送远程请求\n如bigdata3登录到bigdata4：")]),s._v(" "),t("p",[s._v("2、服务器接收到请求后，将自己的主机的公钥发送给客户端，公钥用于加密")]),s._v(" "),t("p",[s._v("3、客户端将主机发送来的公钥通过hash算法得出主机公钥的公钥指纹，核对公钥指纹是否正确，以确认当前请求连接的的是我们想要登录的主机。\n在bigdata4上查看公钥：ssh-keygen -lf /etc/ssh/ssh_host_ecdsa_key.pub\n(我的主机用的是ssh的ECC 算法，通过ssh-keygen -t ecdsa生成密钥对。)\nbigdata4上的公钥和bigdata3请求时SHA256是一样的。")]),s._v(" "),t("p",[s._v("4、核对过公钥后，人机交互界面输入yes,客户端会将服务端的公钥保存在$HOME/.ssh/know_hosts文件中，可通过 cat ～/.ssh/know_hosts文件中查看保存在客户端的公钥。")]),s._v(" "),t("p",[s._v("5、客户端用服务端的公钥将密码进行加密并发送给服务端")]),s._v(" "),t("p",[s._v("6、服务端接收到用自己公钥加密的客户端的密码，用在/etc/ssh下对应的私钥进行解密然后对比密码并返回登录结果，私钥用来解密。")]),s._v(" "),t("p",[s._v("二、ssh的免密码登录（基于密钥）")]),s._v(" "),t("p",[s._v("Hadoop控制脚本(并非守护进程)依赖SSH来执行针对整个集群的操作。为了支持无缝式工作，安装配置好ssh之后，可以是集群内机器的hdfs用户和yarn用户免密码登录。实现的最简单的方法是创建一个公钥/私钥对，存放到NFS中，让整个集群共享该密钥对。如果home目录并没有通过NFS共享，则需要利用ssh-copy-id等方法共享公钥。\n注意：免密登录也不是万能的。免密登录时值从一台主机A的用户userA,使用userB用户（B主机的一个用户）登录到主机B。存在着严格的对应关系：比如只能用bigdata1的root使用bigdata2的root用户登录到主机bigdata2:root@bigdata1 ====>root@bigdata2。\n实现步骤：\n1、在客户端生成一对密钥（公钥/私钥）\n基于空口令生成一个新的ssh密钥，以实现无密码登录：")]),s._v(" "),t("p",[s._v("ssh-keygen -t rsa -P '' -f ~/.ssh/id_rsa\n1\n参数说明：\n-t 加密算法类型，这里是使用rsa算法\n-P 指定私钥的密码，不需要可以不指定\n-f 指定生成秘钥对保持的位置")]),s._v(" "),t("p",[s._v("2、将客户端公钥发送个服务端（其他客户端），使用ssh-copy-id")]),s._v(" "),t("p",[s._v("ssh-copy-id root@bigdata2\n1")]),s._v(" "),t("p",[s._v("注：经过ssh-copy-id后接收公钥的服务端会把公钥追加到服务端对应用户的$HOME/.ssh/authorized_keys文件中")]),s._v(" "),t("p",[s._v("3、客户端请求（带有自己的用户名和主机名）")]),s._v(" "),t("p",[s._v("4、服务端根据客户端的用户名和主机名查找对应的公钥，将一个随机的字符串用该公钥加密后发送给客户端")]),s._v(" "),t("p",[s._v("5、客户端用自己的私钥进行解密收到的字符串，并将解密后的字符串发送给服务端")]),s._v(" "),t("p",[s._v("6、服务端对比发送出去的和接收到的字符串是否相同，返回登录结果\n测试：登录成功")]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("作者：奔跑_蜗牛\n来源：CSDN\n原文：https://blog.csdn.net/m0_37822234/article/details/82494556\n版权声明：本文为博主原创文章，转载请附上博文链接！")])])}),[],!1,null,null,null);e.default=n.exports}}]);