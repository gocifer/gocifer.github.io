(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{436:function(v,t,_){"use strict";_.r(t);var s=_(6),r=Object(s.a)({},(function(){var v=this,t=v.$createElement,_=v._self._c||t;return _("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[_("h1",{attrs:{id:"日志管理"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#日志管理"}},[v._v("#")]),v._v(" 日志管理")]),v._v(" "),_("p",[v._v("在CentOS6.x中日志服务已经由rsyslogd取代了原先的syslogd服务。")]),v._v(" "),_("blockquote",[_("p",[v._v("rsyslogd的新特点：")]),v._v(" "),_("ul",[_("li",[v._v("基于TCP网络协议传输日志信息；")]),v._v(" "),_("li",[v._v("更安全的网络传输方式；")]),v._v(" "),_("li",[v._v("有日志消息的及实分析框架；")]),v._v(" "),_("li",[v._v("后台数据库；")]),v._v(" "),_("li",[v._v("配置文件中可以写简单的逻辑判断；")]),v._v(" "),_("li",[v._v("与syslog配置文件相兼容；")])])]),v._v(" "),_("p",[v._v("##　简介")]),v._v(" "),_("ul",[_("li",[_("p",[v._v("描述：当服务器出现问题时，首先应该去查看日志，找到问题后逐步逐步分析，日志中记录着系统运行的重要信息。")])]),v._v(" "),_("li",[_("p",[v._v("确认服务是否启动")])])]),v._v(" "),_("div",{staticClass:"language- line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[v._v("[root@LinuxProbe ~]# ps aux | grep rsyslogd\nroot        995  0.0  0.2 273532  3704 ?        Ssl  Sep21   0:00 /usr/sbin/rsyslogd -n\nroot       4309  0.0  0.0 112640   984 pts/1    R+   00:35   0:00 grep --color=auto rsyslogd\n[root@LinuxProbe ~]# systemctl status rsyslog.service \nrsyslog.service - System Logging Service\n   Loaded: loaded (/usr/lib/systemd/system/rsyslog.service; enabled)\n   Active: active (running) since Sat 2018-09-22 07:45:33 EDT; 7h left\n Main PID: 995 (rsyslogd)\n   CGroup: /system.slice/rsyslog.service\n           └─995 /usr/sbin/rsyslogd -n\n\nSep 22 07:45:33 jaylinuxprobe.com systemd[1]: Started System Logging Service.\n")])]),v._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[v._v("1")]),_("br"),_("span",{staticClass:"line-number"},[v._v("2")]),_("br"),_("span",{staticClass:"line-number"},[v._v("3")]),_("br"),_("span",{staticClass:"line-number"},[v._v("4")]),_("br"),_("span",{staticClass:"line-number"},[v._v("5")]),_("br"),_("span",{staticClass:"line-number"},[v._v("6")]),_("br"),_("span",{staticClass:"line-number"},[v._v("7")]),_("br"),_("span",{staticClass:"line-number"},[v._v("8")]),_("br"),_("span",{staticClass:"line-number"},[v._v("9")]),_("br"),_("span",{staticClass:"line-number"},[v._v("10")]),_("br"),_("span",{staticClass:"line-number"},[v._v("11")]),_("br"),_("span",{staticClass:"line-number"},[v._v("12")]),_("br")])]),_("h3",{attrs:{id:"常见日志"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#常见日志"}},[v._v("#")]),v._v(" 常见日志")]),v._v(" "),_("table",[_("thead",[_("tr",[_("th",[v._v("日志文件")]),v._v(" "),_("th",[v._v("说明")])])]),v._v(" "),_("tbody",[_("tr",[_("td",[v._v("/var/log/cron")]),v._v(" "),_("td",[v._v("记录了系统定时任务相关的日志。")])]),v._v(" "),_("tr",[_("td",[v._v("/var/log/cups")]),v._v(" "),_("td",[v._v("记录了打印信息的日志。")])]),v._v(" "),_("tr",[_("td",[v._v("/var/log/dmesg")]),v._v(" "),_("td",[v._v("记录了系统在开机时内核自检的信息。也可以使用dmesg命令直接查看内核自检信息。")])]),v._v(" "),_("tr",[_("td",[v._v("/var/log/btmp")]),v._v(" "),_("td",[v._v("记录错误登录的日志。"),_("strong",[v._v("二进制文件")]),v._v("，用"),_("code",[v._v("lastb")]),v._v("命令查看。")])]),v._v(" "),_("tr",[_("td",[v._v("/var/log/lastlog")]),v._v(" "),_("td",[v._v("记录系统中所有用户最后一次登录时间的日志。"),_("strong",[v._v("二进制文件")]),v._v("，用"),_("code",[v._v("lastlog")]),v._v("命令查看")])]),v._v(" "),_("tr",[_("td",[v._v("/var/log/maillog")]),v._v(" "),_("td",[v._v("记录邮件信息")])]),v._v(" "),_("tr",[_("td",[v._v("/var/log/message")]),v._v(" "),_("td",[v._v("记录系统重要信息。这个日志文件中会记录linux系统的绝大多数重要信息，如果系统出现问题时，首先检查的应该是这个文件。")])]),v._v(" "),_("tr",[_("td",[v._v("/var/log/secure")]),v._v(" "),_("td",[v._v("记录验证和授权方面的信息。只要涉及账户和密码的程序都会记录。比如系统登录，ssh，su切换用户，sudo授权，还有添加和修改用户密码也会被记录。")])]),v._v(" "),_("tr",[_("td",[v._v("/var/log/wtmp")]),v._v(" "),_("td",[v._v("永久记录所有用户的登录、注销信息，同时记录系统地启动、重启、关机事件。是 "),_("strong",[v._v("二进制文件")]),v._v("，用"),_("code",[v._v("last")]),v._v("命令查看")])]),v._v(" "),_("tr",[_("td",[v._v("/var/run/utmp")]),v._v(" "),_("td",[v._v("记录当前已登录的用户的信息。这个文件会随着用户的登录贺铸小而不断变化，只记录当前登录用户的信息。是二进制文件，用"),_("code",[v._v("w、who、users")]),v._v("查看")])])])]),v._v(" "),_("blockquote",[_("p",[v._v("注：")]),v._v(" "),_("ul",[_("li",[v._v("除了系统默认的日志之外，采用rpm方法安装的系统服务也会默认把日志记录在"),_("code",[v._v("/var/log/")]),v._v("目录中，而源码包安装的服务日志实在源码包指定的目录中。")]),v._v(" "),_("li",[v._v("但是这些日志不是由rsyslogd服务来记录和管理的，而是各个服务使用自己的日志管理文档来记录自身日志。")]),v._v(" "),_("li",[v._v("常见的比如有："),_("code",[v._v("/var/log/httpd/")]),v._v(","),_("code",[v._v("/var/log/mail/")]),v._v(","),_("code",[v._v("/var/log/samba/")]),v._v(","),_("code",[v._v("/var/log/sssd/")])])])]),v._v(" "),_("h2",{attrs:{id:"rsyslogd服务"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#rsyslogd服务"}},[v._v("#")]),v._v(" rsyslogd服务")]),v._v(" "),_("h3",{attrs:{id:"日志文件格式"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#日志文件格式"}},[v._v("#")]),v._v(" 日志文件格式")]),v._v(" "),_("ul",[_("li",[v._v("格式：\n"),_("ul",[_("li",[v._v("事件产生时间")]),v._v(" "),_("li",[v._v("发生事件的主机名")]),v._v(" "),_("li",[v._v("产生事件的服务名或程序名")]),v._v(" "),_("li",[v._v("事件的具体信息")])])]),v._v(" "),_("li",[v._v("示例："),_("code",[v._v("vim /var/log/secure")])])]),v._v(" "),_("h3",{attrs:{id:"etc-rsyslog-conf配置文件"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#etc-rsyslog-conf配置文件"}},[v._v("#")]),v._v(" "),_("code",[v._v("etc/rsyslog.conf")]),v._v("配置文件")]),v._v(" "),_("ul",[_("li",[v._v("格式："),_("code",[v._v("服务名称[连接符号]日志等级 日志记录位置")])]),v._v(" "),_("li",[v._v("示例：\n"),_("ul",[_("li",[_("code",[v._v("authpriv.* /var/log/secure")])]),v._v(" "),_("li",[v._v("#认证相关的服务.所有日志等级 记录在/var/log/secure")])])]),v._v(" "),_("li",[v._v("常见服务：")])]),v._v(" "),_("table",[_("thead",[_("tr",[_("th",[v._v("服务名称")]),v._v(" "),_("th",[v._v("说明")])])]),v._v(" "),_("tbody",[_("tr",[_("td",[v._v("auth")]),v._v(" "),_("td",[v._v("安全和认证相关消息(不推荐使用authpriv)替代")])]),v._v(" "),_("tr",[_("td",[v._v("authpriv")]),v._v(" "),_("td",[v._v("安全和认证相关消息(私有的)")])]),v._v(" "),_("tr",[_("td",[v._v("cron")]),v._v(" "),_("td",[v._v("系统定时任务cron和at产生的任务")])]),v._v(" "),_("tr",[_("td",[v._v("daemon")]),v._v(" "),_("td",[v._v("和各个守护进程相关的日志")])]),v._v(" "),_("tr",[_("td",[v._v("ftp")]),v._v(" "),_("td",[v._v("ftp守护进程产生的日志")])]),v._v(" "),_("tr",[_("td",[v._v("kern")]),v._v(" "),_("td",[v._v("内核产生的日志(不是用户进程产生的)")])]),v._v(" "),_("tr",[_("td",[v._v("local0-local7")]),v._v(" "),_("td",[v._v("为本地使用预留的服务")])]),v._v(" "),_("tr",[_("td",[v._v("lpr")]),v._v(" "),_("td",[v._v("打印产生的日志")])]),v._v(" "),_("tr",[_("td",[v._v("mail")]),v._v(" "),_("td",[v._v("邮件收发信息")])]),v._v(" "),_("tr",[_("td",[v._v("news")]),v._v(" "),_("td",[v._v("与新闻服务器相关的日志")])]),v._v(" "),_("tr",[_("td",[v._v("syslog")]),v._v(" "),_("td",[v._v("有syslogd服务(包括rsyslogd)服务产生的日志信息")])]),v._v(" "),_("tr",[_("td",[v._v("user")]),v._v(" "),_("td",[v._v("用户等级级别的日志信息")])]),v._v(" "),_("tr",[_("td",[v._v("uucp")]),v._v(" "),_("td",[v._v("uucp子系统日志信息，uucp是早期linux系统进行数据传输的协议，后来也常用在新闻组服务中")])])])]),v._v(" "),_("h3",{attrs:{id:"连接符"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#连接符"}},[v._v("#")]),v._v(" 连接符")]),v._v(" "),_("table",[_("thead",[_("tr",[_("th",[v._v("连接符号")]),v._v(" "),_("th",[v._v("作用")])])]),v._v(" "),_("tbody",[_("tr",[_("td",[_("code",[v._v("*.")])]),v._v(" "),_("td",[v._v("代表服务日志")])]),v._v(" "),_("tr",[_("td",[_("code",[v._v(".*")])]),v._v(" "),_("td",[v._v("代表所有日志等级")])]),v._v(" "),_("tr",[_("td",[_("code",[v._v(".=")])]),v._v(" "),_("td",[v._v("代表只记录所需等级的日志")])]),v._v(" "),_("tr",[_("td",[_("code",[v._v(".！")])]),v._v(" "),_("td",[v._v("代表除了后面的服务等级都记录")])])])]),v._v(" "),_("h3",{attrs:{id:"日志等级"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#日志等级"}},[v._v("#")]),v._v(" 日志等级")]),v._v(" "),_("table",[_("thead",[_("tr",[_("th",[v._v("等级名称")]),v._v(" "),_("th",[v._v("说明")])])]),v._v(" "),_("tbody",[_("tr",[_("td",[v._v("debug")]),v._v(" "),_("td",[v._v("一般的调试信息说明")])]),v._v(" "),_("tr",[_("td",[v._v("info")]),v._v(" "),_("td",[v._v("基本的通知信息")])]),v._v(" "),_("tr",[_("td",[v._v("notice")]),v._v(" "),_("td",[v._v("通知信息，有一定的重要性")])]),v._v(" "),_("tr",[_("td",[v._v("warning")]),v._v(" "),_("td",[v._v("警告信息，但是还不会影响到服务或系统的运行了")])]),v._v(" "),_("tr",[_("td",[v._v("err")]),v._v(" "),_("td",[v._v("错误信息，一般达到err等级的信息已经可以影响到服务或系统的运行了")])]),v._v(" "),_("tr",[_("td",[v._v("crit")]),v._v(" "),_("td",[v._v("临界状况信息，比err等级还要严重")])]),v._v(" "),_("tr",[_("td",[v._v("alert")]),v._v(" "),_("td",[v._v("警告状态信息，比crit还要严重，必须立即采取行动")])]),v._v(" "),_("tr",[_("td",[v._v("emerg")]),v._v(" "),_("td",[v._v("疼痛等级信息，系统已经无法使用了")])])])]),v._v(" "),_("h3",{attrs:{id:"日志的记录位置"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#日志的记录位置"}},[v._v("#")]),v._v(" 日志的记录位置")]),v._v(" "),_("table",[_("thead",[_("tr",[_("th",[v._v("位置")]),v._v(" "),_("th",[v._v("说明")])])]),v._v(" "),_("tbody",[_("tr",[_("td",[_("code",[v._v("/var/log/secure")])]),v._v(" "),_("td",[v._v("日志文件的绝对路径")])]),v._v(" "),_("tr",[_("td",[_("code",[v._v("/dev/lp0")])]),v._v(" "),_("td",[v._v("系统设备文件")])]),v._v(" "),_("tr",[_("td",[_("code",[v._v("@192.168.61.5：514")])]),v._v(" "),_("td",[v._v("转发给远程主机")])]),v._v(" "),_("tr",[_("td",[_("code",[v._v("root")])]),v._v(" "),_("td",[v._v("用户名")])]),v._v(" "),_("tr",[_("td",[_("code",[v._v("~")])]),v._v(" "),_("td",[v._v("忽略或丢弃日志")])]),v._v(" "),_("tr",[_("td",[_("code",[v._v("*")])]),v._v(" "),_("td",[v._v("发送给任何人")])])])]),v._v(" "),_("h2",{attrs:{id:"日志轮替"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#日志轮替"}},[v._v("#")]),v._v(" 日志轮替")]),v._v(" "),_("blockquote",[_("ul",[_("li",[v._v("当日志文件只是不断的增加记录，日志文件就会不断增大体积，导致存储空间占满；此外过于大的纯文本文档也会导致文档打不开甚至死机。")]),v._v(" "),_("li",[v._v("所以需要对日志文件进行切割和轮替。")])])]),v._v(" "),_("h3",{attrs:{id:"日志文件的命名规则"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#日志文件的命名规则"}},[v._v("#")]),v._v(" 日志文件的命名规则")]),v._v(" "),_("ul",[_("li",[v._v("如果配置文件中拥有"),_("code",[v._v("dataext")]),v._v("参数，那么日志会用日期来作为日志文件的后缀，也就不需要重命名日志文件，只需要指定保存文件数；")]),v._v(" "),_("li",[v._v("如果配置文件没有"),_("code",[v._v("dataext")]),v._v("参数，那么日志文件就需要进行改名，旧的文件(比如secure)会自动依次添加"),_("code",[v._v(".1")]),v._v("，"),_("code",[v._v(".2")]),v._v("等后缀(secure.2)，然后会新建新的日志文件(比如secure)")])]),v._v(" "),_("h3",{attrs:{id:"logrotate配置文件"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#logrotate配置文件"}},[v._v("#")]),v._v(" logrotate配置文件")]),v._v(" "),_("ul",[_("li",[v._v("参数说明：")])]),v._v(" "),_("table",[_("thead",[_("tr",[_("th",[v._v("参数")]),v._v(" "),_("th",[v._v("参数说明")])])]),v._v(" "),_("tbody",[_("tr",[_("td",[v._v("daily")]),v._v(" "),_("td",[v._v("轮替周期是每天")])]),v._v(" "),_("tr",[_("td",[v._v("weekly")]),v._v(" "),_("td",[v._v("轮替周期是每周")])]),v._v(" "),_("tr",[_("td",[v._v("monthly")]),v._v(" "),_("td",[v._v("轮替周期是每月")])]),v._v(" "),_("tr",[_("td",[v._v("rotate num")]),v._v(" "),_("td",[v._v("保留的日志文件的个数。0指没有备份")])]),v._v(" "),_("tr",[_("td",[v._v("compress")]),v._v(" "),_("td",[v._v("日志轮替时，旧的日志进行压缩")])]),v._v(" "),_("tr",[_("td",[v._v("create mode owner group")]),v._v(" "),_("td",[v._v("建立指定新日志的权限与所有者和所属组")])]),v._v(" "),_("tr",[_("td",[v._v("mail address")]),v._v(" "),_("td",[v._v("当日志轮替时，输出内容通过邮件发送到指定的邮件地址")])]),v._v(" "),_("tr",[_("td",[v._v("missingok")]),v._v(" "),_("td",[v._v("如果日志不存在，则忽略该日志的警告信息")])]),v._v(" "),_("tr",[_("td",[v._v("notifempty")]),v._v(" "),_("td",[v._v("如果日志为空文件，则不进行日志轮替")])]),v._v(" "),_("tr",[_("td",[v._v("minsize")]),v._v(" "),_("td",[v._v("日志轮替的最小值。也就是日志一定要达到这个最小值才会轮替")])]),v._v(" "),_("tr",[_("td",[v._v("size")]),v._v(" "),_("td",[v._v("日志只有指定大小才进行日志轮替，而不是按照时间轮替。")])]),v._v(" "),_("tr",[_("td",[v._v("dataext")]),v._v(" "),_("td",[v._v("使用日期作为轮替文件的后缀")])])])]),v._v(" "),_("ul",[_("li",[v._v("查看配置文件：")])]),v._v(" "),_("div",{staticClass:"language- line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[v._v("cat /etc/logrotate.conf\n")])]),v._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[v._v("1")]),_("br")])]),_("ul",[_("li",[_("p",[v._v("说明：")]),v._v(" "),_("ul",[_("li",[v._v("大括号外是全局配置，括号里面为局部配置，优先采用针对某一项具体日志的局部配置")]),v._v(" "),_("li",[v._v("默认是只有系统日志和rpm包安装的服务日志才会被logrotate轮替")]),v._v(" "),_("li",[v._v("除了cron添加的用户定时任务，系统中还有系统定时任务，logrotate属于系统定时任务(轮替时间大概是4:00-6:00))")])])]),v._v(" "),_("li",[_("p",[v._v("添加源码包日志的轮替")])])]),v._v(" "),_("div",{staticClass:"language-shell line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-shell"}},[_("code",[_("span",{pre:!0,attrs:{class:"token comment"}},[v._v("# 把下面的配置添加到/etc/logrotate.conf中")]),v._v("\n/opt/apache2/log/access_log "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("{")]),v._v("\n    daily\n    create\n    rotate "),_("span",{pre:!0,attrs:{class:"token number"}},[v._v("16")]),v._v("\n"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("}")]),v._v("\n")])]),v._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[v._v("1")]),_("br"),_("span",{staticClass:"line-number"},[v._v("2")]),_("br"),_("span",{staticClass:"line-number"},[v._v("3")]),_("br"),_("span",{staticClass:"line-number"},[v._v("4")]),_("br"),_("span",{staticClass:"line-number"},[v._v("5")]),_("br"),_("span",{staticClass:"line-number"},[v._v("6")]),_("br")])]),_("ul",[_("li",[v._v("logrotate [选项] 配置文件名\n"),_("ul",[_("li",[v._v("选项：\n"),_("ul",[_("li",[v._v("-v：显示日志轮替过程；")]),v._v(" "),_("li",[v._v("-f：强制进行日志轮替；")])])]),v._v(" "),_("li",[v._v("示例："),_("code",[v._v("logrotate -f /etc/logrotate.conf")])])])])])])}),[],!1,null,null,null);t.default=r.exports}}]);