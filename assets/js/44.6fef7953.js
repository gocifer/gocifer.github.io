(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{459:function(s,e,a){"use strict";a.r(e);var t=a(6),n=Object(t.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"back-restore"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#back-restore"}},[s._v("#")]),s._v(" Back_Restore")]),s._v(" "),a("blockquote",[a("p",[s._v("referenced from:")]),s._v(" "),a("ul",[a("li",[s._v("https://blog.yangmame.org/Gentoo%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B.html")])])]),s._v(" "),a("h1",{attrs:{id:"gentoo安装教程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gentoo安装教程"}},[s._v("#")]),s._v(" Gentoo安装教程")]),s._v(" "),a("p",[s._v("[toc]")]),s._v(" "),a("h2",{attrs:{id:"准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备"}},[s._v("#")]),s._v(" 准备:")]),s._v(" "),a("ol",[a("li",[s._v("一个稳定的网络环境")]),s._v(" "),a("li",[s._v("一个稳定的电源")]),s._v(" "),a("li",[s._v("一个已能完美运行的系统.(如果你是 Linux 系统则不需要下一个)")]),s._v(" "),a("li",[s._v("一个 "),a("a",{attrs:{href:"http://cdimage.ubuntu.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ubuntu ISO"),a("OutboundLink")],1),s._v(" 镜像文件")])]),s._v(" "),a("p",[s._v("如果你是 Windows 系统:\n下载 "),a("a",{attrs:{href:"https://rufus.akeo.ie/?locale=zh_CN",target:"_blank",rel:"noopener noreferrer"}},[s._v("Rufus"),a("OutboundLink")],1),s._v(" 刻录 Ubuntu 镜像\n至于 UEFI Legacy GPT 和 MBR 等我就不说了, 如果不熟悉这些玩 Gentoo 恐怕困难重重")]),s._v(" "),a("p",[s._v("如果你已有一个正常运行的 Linux, 恭喜, 安装 Gentoo 会简单很多.\n安装完并确定可用之后之后你可以 tar 打包已安装的系统使用 live CD 解压过去并修改相关配置")]),s._v(" "),a("h2",{attrs:{id:"需要知道的一些东西"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#需要知道的一些东西"}},[s._v("#")]),s._v(" 需要知道的一些东西")]),s._v(" "),a("p",[s._v("Gentoo 有很多好用的工具，这里说下安装过程会遇到的")]),s._v(" "),a("ul",[a("li",[s._v("eselect 可以用来配置系统")])]),s._v(" "),a("p",[s._v("比如"),a("code",[s._v("eselect python set X")]),s._v("可以设置默认的 python（"),a("code",[s._v("eselect python list")]),s._v("查看可用选项）\n"),a("code",[s._v("eselect fontconfig enable X")]),s._v("可以启用 xxx 字体配置（"),a("code",[s._v("eselct fontconfig list")]),s._v("查看可用选项）")]),s._v(" "),a("ul",[a("li",[s._v("etc-update 可以用来更新 or 生成配置文件")])]),s._v(" "),a("p",[s._v("假如系统更新了软件 有新的配置文件 Gentoo 会生成一个临时的配置文件，需要自己手动删除 合并或覆盖 可以通过运行"),a("code",[s._v("etc-update")]),s._v("进行")]),s._v(" "),a("blockquote",[a("p",[s._v("记住，要尽量保证 emerge 提示无可用更新的配置文件（特别是更新 portage 的配置文件的时候）")])]),s._v(" "),a("h2",{attrs:{id:"ssh（not-necessary）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssh（not-necessary）"}},[s._v("#")]),s._v(" ssh（not necessary）")]),s._v(" "),a("p",[s._v("Into System Boot Interface by press Enter:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("gentoo dopcmcia\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"http://note.youdao.com/yws/res/8455/WEBRESOURCEdcd080650da5812efa08a2270e426fae",alt:"image.png"}})]),s._v(" "),a("p",[s._v("Into Livecd Temporary Boot")]),s._v(" "),a("p",[s._v("In this system, we can simple configure the system that we wanna installed, such as a simple network configuration connection, the system partition, compile the kernel driver, system boot production, etc.")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://note.youdao.com/yws/res/8457/WEBRESOURCE160d4d69acca87abb46244bcdcf49e15",alt:"image.png"}})]),s._v(" "),a("p",[s._v("Configure Root Account")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("livecd ~ # passwd root\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("Open SSH Service")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/etc/init.d/sshd start\nOR:\nservice sshd start \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("Check Network Configure")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("livecd ~ # ifconfig\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("Because I install Gentoo in VMware virtual machine, so the network interface names is different with common interfaces eth0")]),s._v(" "),a("p",[s._v("SSH Login Shell")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('Last login: Fri Apr 25 18:07:24 on ttys000\nxuris-MacBook-Pro:~ xuri$ ssh -l root 172.16.184.146\nPassword:\nWelcome to the Gentoo Linux Minimal Installation CD!\n\nThe root password on this system has been auto-scrambled for security.\n\nIf any ethernet adapters were detected at boot, they should be auto-configured\nif DHCP is available on your network.  Type "net-setup eth0" to specify eth0 IP\naddress settings by hand.\n\nCheck /etc/kernels/kernel-config-* for kernel configuration(s).\nThe latest version of the Handbook is always available from the Gentoo web\nsite by typing "links http://www.gentoo.org/doc/en/handbook/handbook.xml".\n\nTo start an ssh server on this system, type "/etc/init.d/sshd start".  If you\nneed to log in remotely as root, type "passwd root" to reset root\'s password\nto a known value.\n\nPlease report any bugs you find to http://bugs.gentoo.org. Be sure to include\ndetailed information about how to reproduce the bug you are reporting.\nThank you for using Gentoo Linux!\n\nlivecd ~ #\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("h2",{attrs:{id:"连接wifi"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#连接wifi"}},[s._v("#")]),s._v(" 连接wifi")]),s._v(" "),a("p",[s._v("使用命令：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("ifconfig\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("很明显最后一个是无线设备")]),s._v(" "),a("p",[s._v('不同电脑的有线无线设备名称都不同，大部分是"eth0"和"wlan0"')]),s._v(" "),a("p",[s._v("使用命令：(中间的无线设备名称是刚刚ifconfig获得的，不同电脑不一样，请注意，你的可能不是wlp12s0)")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("ifconfig wlp12s0 up         #启动设备\niwconfig wlp12s0 power on       #启动电源管理（可选）\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("扫描WIFI，使用命令：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("iwlist scan\n扫描到的wifi\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("可以看到扫出来一大堆东西，每一个wifi都以call num开头，call 01是我要连接的wifi")]),s._v(" "),a("p",[s._v("下面有一些重要的信息，essid就是wifi的名，IE那一行显示了wifi的加密方式\n我路由器使用的是wpa（当前大部分的路由器都是这个加密，安全！），需使用“wpa_supplicant”命令连接：")]),s._v(" "),a("p",[s._v("在这之前配置一下wpa_supplicant，linux配置文件都在/etc中，\nwpa_supplicant在“/etc/wpa_supplicant/”\n需要在这个目录下添加“wpa_supplicant.conf”\n编辑：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('    network={\n        ssid="Xiaomi_devil"\n        psk=""\n        priority=1\n    }\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("分别是：wifi名，密码，最后一个默认1\n保存退出，进行连接：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("wpa_supplicant -i wlp12s0 -c /etc/wpa_supplicant/wpa_supplicant.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("传统的wpe连接起来更简单，直接连接：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('[root@FriendlyARM /]# iwconfig wlan0 essid "FRIENDLY-ARM"\n[root@FriendlyARM /]# iwconfig wlan0 key s:12345\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("检测了一下网络连接情况，没问题")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("ping baidu.com\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"准备磁盘"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备磁盘"}},[s._v("#")]),s._v(" 准备磁盘")]),s._v(" "),a("p",[s._v("启动到 live CD(已有 Linux 系统忽略这句)\n使用你喜欢的工具进行分区 (或者直接用 gparted)\n这里会声明下分区, 之后的过程将使用这些变量")]),s._v(" "),a("h3",{attrs:{id:"uefi-gpt"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#uefi-gpt"}},[s._v("#")]),s._v(" UEFI(GPT):")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sda1 ---/boot---\x3evfat                   >=200M     #注意分区设置flags为esp\nsda2 ---/---\x3eext4,btrfs,xfs,jfs.etc     >=20G      #建议至少20G大小\nsda3 ---swap---\x3e                        >=2G       #除非你16G内存,即使你8G内存也建议设置2G的swap\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"legacy-mbr"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#legacy-mbr"}},[s._v("#")]),s._v(" Legacy(MBR):")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sda1 ---/boot---\x3eext2                   >=200M     #可以不设置此分区\nsda2 ---/---\x3eext4,btrfs,xfs,jfs.etc     >=20G      #建议至少20G大小\nsda3 ---swap---\x3e                        >=2G       #除非你16G内存,即使你8G内存也建议设置2G的swap\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"我的分区："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#我的分区："}},[s._v("#")]),s._v(" 我的分区：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sdb1 ---/boot/efi---\x3evfat               =1024M      #因为我把所有的启动引导都放这了\nsda8 ---swwap---\x3e                       >8G         #这是我所有linux共有的\nGentoo-boot ---/boot---\x3eext4            >768G       #LVM\nGentoo-main ---/---\x3eext4                =26G        #LVM\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"挂载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#挂载"}},[s._v("#")]),s._v(" 挂载")]),s._v(" "),a("p",[s._v("创建目录:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mkdir -v /mnt/gentoo\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("挂载目录:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mount -v /dev/sda2 /mnt/gentoo\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"安装基本文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装基本文件"}},[s._v("#")]),s._v(" 安装基本文件")]),s._v(" "),a("p",[s._v("在这里你需要选择一个镜像站, 在这里列出几个速度比较快的镜像站, 请亲自测试选择镜像站:")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://mirrors.ustc.edu.cn/",target:"_blank",rel:"noopener noreferrer"}},[s._v("USTC"),a("OutboundLink")],1),s._v(" "),a("a",{attrs:{href:"https://mirrors.tuna.tsinghua.edu.cn/",target:"_blank",rel:"noopener noreferrer"}},[s._v("TUNA"),a("OutboundLink")],1),s._v(" "),a("a",{attrs:{href:"http://mirrors.163.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("163"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("进入镜像站的"),a("code",[s._v("/gentoo/releases/amd64/autobuilds/")]),s._v("目录")]),s._v(" "),a("p",[s._v("如果你对 systemd 没有刚需则进入"),a("code",[s._v("current-stage3-amd64/")]),s._v("目录选择最新的"),a("code",[s._v("stage3")]),s._v("下载到本地的"),a("code",[s._v("/mnt/gentoo")]),s._v("目录, 例如: stage3-amd64-20171019.tar.bz2")]),s._v(" "),a("p",[s._v("如果你需要 systemd, 则进入"),a("code",[s._v("current-stage3-amd64-systemd/")]),s._v("目录选择最新的"),a("code",[s._v("stage3")]),s._v("下载到本地的"),a("code",[s._v("/mnt/gentoo")]),s._v("目录, 例如: stage3-amd64-systemd-20171018.tar.bz2")]),s._v(" "),a("p",[s._v("下载完成之后进入 gentoo 的根目录并解压文件:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cd /mnt/gentoo\ntar vxpf stage3-*.tar.bz2或xz --xattrs-include='*.*' --numeric-owner\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"配置make-conf和-portage-mirror"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置make-conf和-portage-mirror"}},[s._v("#")]),s._v(" 配置"),a("code",[s._v("make.conf")]),s._v("和 Portage Mirror")]),s._v(" "),a("p",[s._v("以下参数在经过自己调整或选择之后加入到 "),a("code",[s._v("/mnt/gentoo/etc/portage/make.conf")])]),s._v(" "),a("ul",[a("li",[s._v("USE: 首先, 你可以删掉默认的 USE 标记，加上"),a("code",[s._v("-bindist")]),s._v(" (不了解 USE 的情况下建议如此)")]),s._v(" "),a("li",[s._v("CFLAGS: 将 CFLAGS 修改为"),a("code",[s._v('CFLAGS="-march=native -O2 -pipe"')]),s._v(" 或者你也可以指定. 例如我的 Intel CPU 是 haswell, 将 native 换成 haswell 就行 (不确定就不要指定). 你也可以在"),a("a",{attrs:{href:"https://www.funtoo.org/Subarches",target:"_blank",rel:"noopener noreferrer"}},[s._v("这里"),a("OutboundLink")],1),s._v("看到所有可以设置的值")]),s._v(" "),a("li",[s._v("MAKEOPTS: 根据你的 CPU 核心数设置 MAKEOPTS 例如双四线程设置为"),a("code",[s._v('MAKEOPTS="-j5"')])]),s._v(" "),a("li",[s._v("GENTOO_MIRRORS: 设置为"),a("code",[s._v('GENTOO_MIRRORS="https://mirrors.ustc.edu.cn/gentoo/"')]),s._v(" 请自行选择速度最快的 Mirror")]),s._v(" "),a("li",[s._v("EMERGE_DEFAULT_OPTS: 设置为"),a("code",[s._v('EMERGE_DEFAULT_OPTS="--keep-going --with-bdeps=y"')]),s._v("是个不错的选择, keep going 意为安装一堆软件时遇到编译错误自动跳过这个软件继续编译安装")]),s._v(" "),a("li",[s._v("FEATURES: 在这里最好写成"),a("code",[s._v('# FEATURES="${FEATURES} -userpriv -usersandbox -sandbox"')]),s._v(", 最好在前面加上 #注释掉, 在你编译软件遇到权限不足时去掉注释即可解决问题（但请务必注意是不是因为"),a("code",[s._v("rm -rf /*")]),s._v("等命令权限不足，因为说不定你的 ebuild 文件被篡改了）")]),s._v(" "),a("li",[s._v("ACCEPT_KEYWORDS: 如果你想用作桌面 / 学习 / 开发系统那就务必加上"),a("code",[s._v('ACCEPT_KEYWORDS="~amd64"')]),s._v("，服务器 / 工作 / 家 / 娱乐用可以忽略")]),s._v(" "),a("li",[s._v("ACCEPT_LICENSE: 加上"),a("code",[s._v('ACCEPT_LICENSE="*"')]),s._v("表示此系统接受所有软件许可证, 即不论非自由还是自由软件都接受, 非商业用户基本不需要考虑")]),s._v(" "),a("li",[s._v("L10N: 设置为"),a("code",[s._v('L10N="en-US zh-CN en zh"')])]),s._v(" "),a("li",[s._v("LINGUAS: 设置为"),a("code",[s._v('LINGUAS="en_US zh_CN en zh"')])]),s._v(" "),a("li",[s._v("VIDEO_CARDS: 根据你的显卡类型设置假如你是 NVIDIA 单显卡则设置为"),a("code",[s._v('VIDEO_CARDS="nvidia"')]),s._v("(闭源驱动)"),a("code",[s._v('VIDEO_CARDS="nouveau"')]),s._v("(开源驱动). 还有 radeon 和 intel, 但如果你是双显卡例如 Intel+NVIDIA 则设置为"),a("code",[s._v('VIDEO_CARDS="intel i965 nvidia"')]),s._v("(只要不是远古的集成显卡都是用 i965)")]),s._v(" "),a("li",[s._v("GRUB_PLATFORMS: 如果你使用 GRUB 且使用 UEFI 启动则添加"),a("code",[s._v('GRUB_PLATFORMS="efi-64"')])]),s._v(" "),a("li",[s._v("Portage Mirror: 这个不是 make.conf 的选项.创建 repos.conf 目录并添加如下到 / mnt/gentoo/etc/portage/repos.conf/gentoo.conf 文件里面 (自行选择速度最快的镜像站):")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mkdir /mnt/gentoo/etc/portage/repos.conf \ncp /mnt/gentoo/usr/share/portage/config/repos.conf /mnt/gentoo/etc/portage/repos.conf/gentoo.conf \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[gentoo]\nlocation = /usr/portage\nsync-type = rsync\n#sync-uri = rsync://mirrors.tuna.tsinghua.edu.cn/gentoo-portage/\nsync-uri = rsync://rsync.mirrors.ustc.edu.cn/gentoo-portage/\nauto-sync = yes\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("示例配置（请以实际为标准）：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mirrorselect -i -o >> /mnt/gentoo/etc/portage/make.conf \nOR：\ncp /usr/share/portage/config/make.conf.example /usr/share/portage/config/make.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('# /usr/share/portage/config/make.conf.example\n\n# GCC\n**CFLAGS="-march=haswell -O2 -pipe"\nCXXFLAGS="${CFLAGS}"\nCHOST="x86_64-pc-linux-gnu"\nCPU_FLAGS_X86="aes avx avx2 fma3 mmx mmxext pclmul popcnt sse sse2 sse3 sse4_1 sse4_2 ssse3"\n**MAKEOPTS="-j5"\n\n# USE\nSUPPORT="pulseaudio btrfs mtp git chromium"\nDESKTOP="infinality emoji cjk"\nFUCK="-bindist -grub -plymouth -systemd consolekit -modemmanager -gnome-shell -gnome -gnome-keyring -nautilus -modules"\nELSE="client icu sudo python"\n\nUSE="${SUPPORT} ${DESKTOP} ${FUCK} ${ELSE}"\n\n# Portage\nPORTDIR="/usr/portage"\nDISTDIR="${PORTDIR}/distfiles"\nPKGDIR="${PORTDIR}/packages"\n# GENTOO_MIRRORS="https://mirrors.tuna.tsinghua.edu.cn/gentoo/"\nGENTOO_MIRRORS="https://mirrors.ustc.edu.cn/gentoo/"\nEMERGE_DEFAULT_OPTS="--ask --verbose=y --keep-going --with-bdeps=y --load-average"\n# FEATURES="${FEATURES} -userpriv -usersandbox -sandbox"\nPORTAGE_REPO_DUPLICATE_WARN="0"\n# PORTAGE_TMPDIR="/var/tmp/notmpfs"\n\nACCEPT_KEYWORDS="~amd64"\nACCEPT_LICENSE="*"\n\n# Language\nL10N="en-US zh-CN en zh"\nLINGUAS="en_US zh_CN en zh"\n\n# Else\n**VIDEO_CARDS="intel i965 nvidia"\n\n**RUBY_TARGETS="ruby24 ruby25"\n\n**LLVM_TARGETS="X86"\n\n**QEMU_SOFTMMU_TARGETS="alpha aarch64 arm i386 mips mips64 mips64el mipsel ppc ppc64 s390x sh4 sh4eb sparc sparc64 x86_64"\n**QEMU_USER_TARGETS="alpha aarch64 arm armeb i386 mips mipsel ppc ppc64 ppc64abi32 s390x sh4 sh4eb sparc sparc32plus sparc64"\n# ABI_X86="64 32"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br")])]),a("h2",{attrs:{id:"进入-chroot-环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#进入-chroot-环境"}},[s._v("#")]),s._v(" 进入 Chroot 环境")]),s._v(" "),a("h3",{attrs:{id:"复制-dns"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#复制-dns"}},[s._v("#")]),s._v(" 复制 DNS:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cp --dereference /etc/resolv.conf /mnt/gentoo/etc/\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"挂载必要文件系统"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#挂载必要文件系统"}},[s._v("#")]),s._v(" 挂载必要文件系统:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mount -t proc /proc /mnt/gentoo/proc\nmount --rbind /sys /mnt/gentoo/sys\nmount --make-rslave /mnt/gentoo/sys\nmount --rbind /dev /mnt/gentoo/dev\nmount --make-rslave /mnt/gentoo/dev\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("如果你有 boot 分区则在这里挂载上去:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mount /dev/sda1 /mnt/gentoo/boot\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("Debian 等发行版可能需要：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("test -L /dev/shm && rm /dev/shm && mkdir /dev/shm\nmount --types tmpfs --options nosuid,nodev,noexec shm /dev/shm\nchmod 1777 /dev/shm\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"进入-chroot"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#进入-chroot"}},[s._v("#")]),s._v(" 进入 Chroot:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("chroot /mnt/gentoo /bin/bash\nsource /etc/profile\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"add-swap分区"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#add-swap分区"}},[s._v("#")]),s._v(" ADD:SWAP分区")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mkswap /dev/sda2\nswapon /dev/sda2\nswapon -s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"选择-profile-并更新系统"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#选择-profile-并更新系统"}},[s._v("#")]),s._v(" 选择 Profile 并更新系统")]),s._v(" "),a("p",[s._v("使用快照更新 Portage:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("emerge-webrsync\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("使用 rsync 同步:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("emerge --sync\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("这里还有个 CPU_FLAGS_X86, 在"),a("code",[s._v("emerge --sync")]),s._v("之后安装"),a("code",[s._v("app-portage/cpuid2cpuflags")]),s._v("并配置:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("emerge --ask app-portage/cpuid2cpuflags\ncpuid2cpuflags #将输出值改入CPU_FLAGS_X86\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("使用"),a("code",[s._v("eselect news read")]),s._v("命令阅读新闻")]),s._v(" "),a("p",[s._v("列出 profile:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("eselect profile list\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("如果你使用 systemd 则需要选上带有 systemd 字样的选项")]),s._v(" "),a("p",[s._v("如果你不使用 systemd 则不建议使用 GNOME 桌面, 因为 GNOME 桌面依赖 systemd(辣鸡)")]),s._v(" "),a("p",[s._v("例如不使用 systemd 且使用 KDE 桌面则选择 19 default/linux/amd64/17.0/desktop/plasma:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("eselect profile set 19\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("然后就是漫长的更新了 (有钱人当我没说):")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("emerge -auvDN --with-bdeps=y @world\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("如果碰到未满足的 xxx 或者其它提示:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("emerge -auvDN --with-bdeps=y --autounmask-write @world\netc-update # 然后输入-3就能更新配置,确保再次运行时没有可更新的文件\nemerge -auvDN --with-bdeps=y @world\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("blockquote",[a("p",[s._v("如果以上还是不能解决问题, 则进入 / etc/portage 目录删掉 package.use,package.mask 和 package.unmask 文件或目录再次尝试_**")])]),s._v(" "),a("p",[s._v("到了这里, 你可以去看电影了...")]),s._v(" "),a("p",[s._v("等它跑完了, 先别急\n运行下这几个命令:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("emerge @preserved-rebuild\nperl-cleaner --all\nemerge -auvDN --with-bdeps=y @world\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("确定没有更新之后再继续，否则查看输出尝试重复运行")]),s._v(" "),a("p",[s._v("如果你在"),a("code",[s._v("emerge -auvDN --with-bdeps=y @world")]),s._v("时提示带有"),a("code",[s._v("bindsit")]),s._v("字样且你已启用"),a("code",[s._v('ACCEPT_KEYWORDS="~amd64"')]),s._v("的话\n运行如下命令之后再次重试：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cd /usr/portage/dev-libs/openssl/\nebuild openssl-1.0.2o-r6.ebuild merge # 这里openssl的版本可能和你的不一样，运行ls命令查看可用版本，替换为版本号带o字母的即可\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"配置时区和地区"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置时区和地区"}},[s._v("#")]),s._v(" 配置时区和地区")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('echo "Asia/Shanghai" > /etc/timezone\nemerge --config sys-libs/timezone-data\n\necho "en_US.UTF-8 UTF-8\nzh_CN.UTF-8 UTF-8" >> /etc/locale.gen\n\nlocale-gen\n\neselect locale list\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("这里建议使用英语易于排错, 之后你可以自行换成中文:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("eselect locale set X # X换成上面命令显示的序号\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"配置-fstab-安装文件系统工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-fstab-安装文件系统工具"}},[s._v("#")]),s._v(" 配置 fstab, 安装文件系统工具")]),s._v(" "),a("p",[s._v("如果你和我一样懒")]),s._v(" "),a("p",[s._v("可以下载此脚本自动配置 fstab(引自 Arch 的 genfstab):")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("wget https://raw.githubusercontent.com/YangMame/Gentoo-Installer/master/genfstab\nchmod +x genfstab\n#可选 cp genfstab /usr/bin/\n./genfstab / > /etc/fstab\nnano /etc/fstab #最好检查下此文件,删掉无用挂载点\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("上面的脚本在 chroot 环境下不能正常使用 - U 参数在 fstab 写入分区的 UUID")]),s._v(" "),a("p",[s._v("挂载点主要有俩种格式:")]),s._v(" "),a("h3",{attrs:{id:"dev"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dev"}},[s._v("#")]),s._v(" /dev/")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/dev/sda1    /boot    vfat或ext2    defaults    0 0\n/dev/sda2    /    ext4或btrfs,jfs,xfs.etc    defaults    0 0\n/dev/sda3    none    swap    defaults    0 0\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"uuid"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#uuid"}},[s._v("#")]),s._v(" UUID")]),s._v(" "),a("p",[s._v("这里的 UUID 通过 blkid 查看")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("UUID=xxxxxxxxxxx   /boot    vfat或ext2    defaults    0 0\nUUID=xxxxxxxxxxx    /    ext4或btrfs,jfs,xfs.etc    defaults    0 0\nUUID=xxxxxxxxxxx    none    swap    defaults    0 0\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"文件系统支持"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件系统支持"}},[s._v("#")]),s._v(" 文件系统支持")]),s._v(" "),a("p",[s._v("如果你使用非 ext4 文件系统则在编译内核前需要另外安装相应的工具:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("btrfs: emerge sys-fs/btrfs-progs\nxfs: emerge sys-fs/xfsprogs\njfs: emerge sys-fs/jfsutils\nlvm: emerge --ask sys-fs/lvm2\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"network"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#network"}},[s._v("#")]),s._v(" network")]),s._v(" "),a("h3",{attrs:{id:"config（not-necessary）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#config（not-necessary）"}},[s._v("#")]),s._v(" config（not necessary）")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('vim /etc/conf.d/net \ndns_domain_lo="test.local" \n\n\nemerge --ask --noreplace net-misc/netifrc \n\n\nvim /etc/conf.d/net \nconfig_eno16777728="dhcp" \n\n\ncd /etc/init.d \nln -s net.lo net.eno16777728 \n\n\nrc-update add net.eno16777728 default \n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h3",{attrs:{id:"安装-networkmanager"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-networkmanager"}},[s._v("#")]),s._v(" 安装 NetworkManager")]),s._v(" "),a("p",[s._v("没错, 我很懒, 又加上我是 KDE 桌面用户, 所以我选择使用 NetworkManager 连接网络:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("emerge -av networkmanager\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果它说有未满足的 xxxx 或者其它提示:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("emerge --autounmask-write networkmanager\netc-update --automode -3\nemerge networkmanager\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("openRC(即非 systemd) 添加开机服务:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("rc-update add NetworkManager default\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("systemd 添加开机服务:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("systemctl enable NetworkManager\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"修改主机名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改主机名"}},[s._v("#")]),s._v(" 修改主机名")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('echo hostname=\\"Test\\" > /etc/conf.d/hostname\nOR:\nvim /etc/conf.d/hostname \n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"安装一些必要工具并配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装一些必要工具并配置"}},[s._v("#")]),s._v(" 安装一些必要工具并配置")]),s._v(" "),a("h3",{attrs:{id:"system-log-management"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#system-log-management"}},[s._v("#")]),s._v(" System Log Management")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("(chroot) livecd src # emerge syslog-ng\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"log-formatting-tools"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#log-formatting-tools"}},[s._v("#")]),s._v(" Log Formatting Tools")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("(chroot) livecd src # emerge logrotate\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"timer-planning-services"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#timer-planning-services"}},[s._v("#")]),s._v(" Timer Planning Services")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("(chroot) livecd src # emerge vixie-cron\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"dhcp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dhcp"}},[s._v("#")]),s._v(" DHCP")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("(chroot) livecd src # emerge dhcpcd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"quick-index"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#quick-index"}},[s._v("#")]),s._v(" Quick Index")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("(chroot) livecd src # emerge mlocate\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"start-service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#start-service"}},[s._v("#")]),s._v(" Start Service")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("(chroot) livecd src # rc-update add syslog-ng default\n * service syslog-ng added to runlevel default\n(chroot) livecd src # rc-update add vixie-cron default\n * service vixie-cron added to runlevel default\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"set-rontab-default-editor"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#set-rontab-default-editor"}},[s._v("#")]),s._v(" Set rontab Default Editor")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("emerge vim\n(chroot) livecd src # echo \"export EDITOR='/usr/bin/vim'\" >> /etc/profile\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"登录和密码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#登录和密码"}},[s._v("#")]),s._v(" 登录和密码")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("emerge app-admin/sysklogd sys-process/cronie sudo layman \nsed -i 's/\\# \\%wheel ALL=(ALL) ALL/\\%wheel ALL=(ALL) ALL/g' /etc/sudoers\npasswd #是时候设置root密码了\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("如果你是 systemd:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('sed -i \'s/\\# GRUB_CMDLINE_LINUX=\\"init=\\/usr\\/lib\\/systemd\\/systemd\\"/GRUB_CMDLINE_LINUX=\\"init=\\/usr\\/lib\\/systemd\\/systemd\\"/g\' /etc/default/grub\nln -sf /proc/self/mounts /etc/mtab\nsystemd-machine-id-setup\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("非 systemd 系统:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("rc-update add sysklogd default\nrc-update add cronie default\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"配置编译安装内核"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置编译安装内核"}},[s._v("#")]),s._v(" 配置编译安装内核")]),s._v(" "),a("h3",{attrs:{id:"内核"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#内核"}},[s._v("#")]),s._v(" 内核")]),s._v(" "),a("p",[s._v("有以下推荐内核可供选择:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("gentoo-sources\nck-sources\ngit-sources\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("这里示例使用 gentoo-sources:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("emerge -av gentoo-sources\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"简单配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简单配置"}},[s._v("#")]),s._v(" 简单配置")]),s._v(" "),a("p",[s._v("如果你不会配置内核或者时间不允许可以先用"),a("code",[s._v("genkernel")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("emerge -av genkernel\ngenkernel --menuconfig all\ngenkernel --install initramfs\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"手动配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手动配置"}},[s._v("#")]),s._v(" 手动配置")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cd /usr/src/linux\nmake menuconfig\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("配置完之后:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("make -jX #将X替换为你想编译时的线程数\nmake modules_install\nmake install\ngenkernel --install initramfs\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"about"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#about"}},[s._v("#")]),s._v(" About")]),s._v(" "),a("h4",{attrs:{id:"lvm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lvm"}},[s._v("#")]),s._v(" LVM")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("genkernel --lvm --install initramfs \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"报错"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#报错"}},[s._v("#")]),s._v(" 报错")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('* WARNING... WARNING... WARNING...\n* Additional kernel cmdline arguments that *may* be required to boot properly...\n* With support for several ext* filesystems available, it may be needed to\n* add "rootfstype=ext3" or "rootfstype=ext4" to the list of boot parameters.\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("blockquote",[a("p",[s._v("The error regarding mounting /boot was due to the fact that I am running in a chroot; the installation of the kernel was not affected.")])]),s._v(" "),a("h4",{attrs:{id:"kernel-makefile-usr-src-linux-makefile-missing"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kernel-makefile-usr-src-linux-makefile-missing"}},[s._v("#")]),s._v(" Kernel Makefile (/usr/src/linux/Makefile) missing")]),s._v(" "),a("p",[s._v("Make sure to install kernel sources:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("root # emerge --ask sys-kernel/gentoo-sources\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("If the sources are already installed, make sure you have selected a valid kernel:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("root # eselect kernel list\nAvailable kernel symlink targets:\n  [1]   linux-4.4.6-gentoo\n  [2]   linux-4.4.21-gentoo\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("The absence of a star above indicates that no kernel is currently selected.\nDo so now:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("root #  eselect kernel set 2\nroot # eselect kernel list\nAvailable kernel symlink targets:\n  [1]   linux-4.4.6-gentoo\n  [2]   linux-4.4.21-gentoo *\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"安装-grub-并创建用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-grub-并创建用户"}},[s._v("#")]),s._v(" 安装 GRUB 并创建用户")]),s._v(" "),a("h3",{attrs:{id:"for-lvm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#for-lvm"}},[s._v("#")]),s._v(" for LVM")]),s._v(" "),a("p",[s._v("Summary")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("vim /etc/portage/package.use/package.use \n\nsys-boot/grub:2 device-mapper \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("emerge --ask --verbose sys-boot/grub:2 \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('vim /etc/default/grub \n\nGRUB_CMDLINE_LINUX_DEFAULT="dolvm" \n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("再建立生成引导：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("grub-install 。。。。。。 \n\ngrub-mkconfig -o /boot/grub/grub.cfg \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"emerge"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#emerge"}},[s._v("#")]),s._v(" emerge")]),s._v(" "),a("p",[s._v("GRUB needs to be compiled with "),a("em",[s._v("device-mapper")]),s._v(", execute the following command first:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("echo 'sys-boot/grub:2 device-mapper' >> /etc/portage/package.use/package.use\nemerge --ask --verbose sys-boot/grub:2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"configure"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configure"}},[s._v("#")]),s._v(" Configure")]),s._v(" "),a("p",[s._v("The "),a("code",[s._v("dolvm")]),s._v(" option needs to be enabled for "),a("code",[s._v("GRUB_CMDLINE_LINUX_DEFAULT")]),s._v(" in the /etc/default/grub file, edit it:")]),s._v(" "),a("p",[a("code",[s._v("vim /etc/default/grub")])]),s._v(" "),a("p",[s._v("Configure the option:")]),s._v(" "),a("p",[s._v("FILE "),a("strong",[a("code",[s._v("/etc/default/grub")])]),s._v(" "),a("strong",[s._v("GRUB_CMDLINE_LINUX_DEFAULT option")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('GRUB_CMDLINE_LINUX_DEFAULT="dolvm"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"generate-the-grub2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#generate-the-grub2"}},[s._v("#")]),s._v(" generate the GRUB2")]),s._v(" "),a("h4",{attrs:{id:"uefi"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#uefi"}},[s._v("#")]),s._v(" UEFI:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=Gentoo\ngrub-mkconfig -o /boot/grub/grub.cfg\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("如果出现"),a("code",[s._v("No space left on device")])]),s._v(" "),a("p",[s._v("请运行：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mount -t efivarfs efivarfs /sys/firmware/efi/efivars\nrm /sys/firmware/efi/efivars/dump-*\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("然后重试（由 @Chara 提议加上）")]),s._v(" "),a("h3",{attrs:{id:"legacy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#legacy"}},[s._v("#")]),s._v(" Legacy:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("grub-install --target=i386-pc /dev/sda\ngrub-mkconfig -o /boot/grub/grub.cfg\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"some-tips"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#some-tips"}},[s._v("#")]),s._v(" some tips")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://note.youdao.com/yws/res/8354/WEBRESOURCE79d43e8a9e3e6ee9f40e3a0cf58aaf4b",alt:"image.png"}})]),s._v(" "),a("h3",{attrs:{id:"管理员"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#管理员"}},[s._v("#")]),s._v(" 管理员")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("useradd -m -G users,wheel,portage,usb,video 这里换成你的用户名(小写)\npasswd 用户名\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"显卡驱动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#显卡驱动"}},[s._v("#")]),s._v(" 显卡驱动")]),s._v(" "),a("p",[s._v("NVIDIA 单显卡:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("emerge -av x11-drivers/nvidia-drivers\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("Intel 单显卡:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("emerge -av x11-drivers/xf86-video-intel\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("Intel+NVIDIA 双显卡请看这篇"),a("a",{attrs:{href:"https://blog.yangmame.top/Gentoo%E5%8F%8C%E6%98%BE%E5%8D%A1%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("文章"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("其它显卡硬件待补坑 欢迎提出")]),s._v(" "),a("h2",{attrs:{id:"检查系统可用性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检查系统可用性"}},[s._v("#")]),s._v(" 检查系统可用性")]),s._v(" "),a("p",[s._v("到了这里你应该可以重启查看系统是否能正常启动, 然后在安装桌面")]),s._v(" "),a("p",[s._v("重启前最好检查下的东西:")]),s._v(" "),a("ol",[a("li",[s._v("boot 目录是否有相应文件")]),s._v(" "),a("li",[s._v("GRUB 是否正确生成配置并显示内核等文件")]),s._v(" "),a("li",[s._v("fstab 是否正确无误")])]),s._v(" "),a("h2",{attrs:{id:"安装桌面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装桌面"}},[s._v("#")]),s._v(" 安装桌面")]),s._v(" "),a("p",[s._v("首先需要确保已安装 xorg-server 和显卡驱动:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("emerge -av xorg-server\nemerge xf86-video-intel #Intel显卡驱动\nemerge nvidia-drivers #nvidia显卡驱动\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("如遇需要更新配置则运行"),a("code",[s._v("etc-update --automode -3")]),s._v("并再次运行命令")]),s._v(" "),a("h3",{attrs:{id:"kde"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kde"}},[s._v("#")]),s._v(" KDE:")]),s._v(" "),a("blockquote",[a("p",[s._v("emerge chromium kde-plasma/plasma-meta")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("emerge -av plasma-desktop kde-plasma/kdeplasma-addons plasma-nm plasma-pa sddm konsole\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[s._v("kde-plasma/powerdevil (power management, suspend and hibernate options)")]),s._v(" "),a("li",[s._v("kde-plasma/systemsettings")])]),s._v(" "),a("p",[s._v("By default the classic tree view of kde-plasma/systemsettings is not enabled. The following USE flag will enable it:")]),s._v(" "),a("ul",[a("li",[s._v("FILE "),a("code",[s._v("/etc/portage/package.use/systemsettings")]),s._v("  Enable classic tree view")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("kde-plasma/systemsettings classic\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("Recompile systemsettings with new USE flags:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("root #emerge --ask --changed-use kde-plasma/systemsettings\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如遇需要更新配置则运行"),a("code",[s._v("etc-update --automode -3")]),s._v("并再次运行命令")]),s._v(" "),a("p",[s._v("如果你是 systemd:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("systemctl enable sddm\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("openrc 则编辑"),a("code",[s._v("/etc/conf.d/xdm")]),s._v("将"),a("code",[s._v("DISPLAYMANAGER")]),s._v("的值改为"),a("code",[s._v("sddm")]),s._v("并:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("rc-update add xdm default\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"gnome"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gnome"}},[s._v("#")]),s._v(" GNOME:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("emerge -av gnome-shell gdm gnome-terminal\nsystemctl enable gdm\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("如遇需要更新配置则运行"),a("code",[s._v("etc-update --automode -3")]),s._v("并再次运行命令")]),s._v(" "),a("p",[a("strong",[a("em",[s._v("这里只说明 systemd, 因为 openrc 并不能满足 GNOME 的依赖")])])]),s._v(" "),a("h2",{attrs:{id:"nouveau驱动问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nouveau驱动问题"}},[s._v("#")]),s._v(" nouveau驱动问题")]),s._v(" "),a("blockquote",[a("p",[s._v("如果因为nouveau驱动启动不了桌面环境，可以屏蔽掉")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('echo "blacklist nouveau" >> /etc/modprobe.d/blacklist.conf\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[s._v("如果仍然有问题，可以修改一下显卡相关的配置文件")])]),s._v(" "),a("ul",[a("li",[s._v("通过 lspci -k 查看内核配置检查(确保以下grep显示y）：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cd /usr/src/linux\ncat .config | grep CONFIG_MODULES=\ncat .config | grep CONFIG_MODULE_UNLOAD=\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("编辑/etc/portage/make.conf添加如下：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("VIDEO_CARDS=”intel i965 nvidia”\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("更新：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("emerge –-sync && emerge -avuDN @world\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("到这里可以重新安装一下内核")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[s._v("据实践，步骤进行到这里就可以正常启动桌面环境了")])]),s._v(" "),a("h2",{attrs:{id:"继续以下安装nvidia显卡驱动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#继续以下安装nvidia显卡驱动"}},[s._v("#")]),s._v(" 继续以下安装nvidia显卡驱动")]),s._v(" "),a("ul",[a("li",[s._v("添加如下内容到/etc/portage/package.accept_keywords：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("=sys-power/bbswitch-9999 **\n=x11-misc/bumblebee-9999 **\n=x11-misc/primus-0.2 ~amd64\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("安装：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("emerge -av bbswitch primus bumblebee\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("用户组：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("gpasswd -a 你的用户名 video && gpasswd -a 你的用户名 bumblebee\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("编辑/etc/init.d/bumblebee 删除以下内容：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("depend() {\nneed xdm\nneed vgl\nafter sshd\n} # 可能稍有不同 但放心的删掉depend(){…}就行了 因为根本不需要\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ul",[a("li",[s._v("编辑/etc/bumblebee/bumblebee.conf 修改为以下参数：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("KeepUnusedXServer=false\nDriver=nvidia\nBridge=primus\nVGLTransport=rgb (如果你使用vgl则修改此参数)\nKernelDriver=nvidia\nPMMethod=bbswitch\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("ul",[a("li",[s._v("开机服务：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("rc-update add bumblebee default\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("测试：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("optirun neofetch # neofetch可替换\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("PS：如果你还没有桌面则使用primusrun")])])])}),[],!1,null,null,null);e.default=n.exports}}]);