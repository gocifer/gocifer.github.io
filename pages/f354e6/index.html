<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>iptables | Gocifer&#39;s blog</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="云原生技术博客，专注于计算机、网络、云计算相关技术的学习和总结。Linux，网络，运维，云计算，golang，云原生，网络安全等技术文章。">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.1ba410de.css" as="style"><link rel="preload" href="/assets/js/app.5bb0b44e.js" as="script"><link rel="preload" href="/assets/js/2.717babc4.js" as="script"><link rel="preload" href="/assets/js/32.442e6531.js" as="script"><link rel="prefetch" href="/assets/js/10.3e114544.js"><link rel="prefetch" href="/assets/js/11.4161c730.js"><link rel="prefetch" href="/assets/js/12.e2b56866.js"><link rel="prefetch" href="/assets/js/13.26d11d5a.js"><link rel="prefetch" href="/assets/js/14.101242cd.js"><link rel="prefetch" href="/assets/js/15.aeeabc5e.js"><link rel="prefetch" href="/assets/js/16.501e71d2.js"><link rel="prefetch" href="/assets/js/17.25c53b09.js"><link rel="prefetch" href="/assets/js/18.76227f51.js"><link rel="prefetch" href="/assets/js/19.9d5c5e01.js"><link rel="prefetch" href="/assets/js/20.341b2b12.js"><link rel="prefetch" href="/assets/js/21.114174e0.js"><link rel="prefetch" href="/assets/js/22.c1e44e04.js"><link rel="prefetch" href="/assets/js/23.e7c42960.js"><link rel="prefetch" href="/assets/js/24.f1f7cdcf.js"><link rel="prefetch" href="/assets/js/25.5967fc32.js"><link rel="prefetch" href="/assets/js/26.41a226b5.js"><link rel="prefetch" href="/assets/js/27.bb0aa905.js"><link rel="prefetch" href="/assets/js/28.cfe8776c.js"><link rel="prefetch" href="/assets/js/29.cc05a8f8.js"><link rel="prefetch" href="/assets/js/3.cd13fc02.js"><link rel="prefetch" href="/assets/js/30.d5b46292.js"><link rel="prefetch" href="/assets/js/31.c027a203.js"><link rel="prefetch" href="/assets/js/33.82b70710.js"><link rel="prefetch" href="/assets/js/34.b8848f81.js"><link rel="prefetch" href="/assets/js/35.bc60de53.js"><link rel="prefetch" href="/assets/js/36.1f2a2d01.js"><link rel="prefetch" href="/assets/js/37.fcb90e28.js"><link rel="prefetch" href="/assets/js/38.b14fdbcd.js"><link rel="prefetch" href="/assets/js/39.851097e7.js"><link rel="prefetch" href="/assets/js/4.be18f558.js"><link rel="prefetch" href="/assets/js/40.f527e03d.js"><link rel="prefetch" href="/assets/js/41.d76d2a9f.js"><link rel="prefetch" href="/assets/js/42.951864f6.js"><link rel="prefetch" href="/assets/js/43.4bf254e0.js"><link rel="prefetch" href="/assets/js/44.6fef7953.js"><link rel="prefetch" href="/assets/js/45.0adf5159.js"><link rel="prefetch" href="/assets/js/46.b40047ba.js"><link rel="prefetch" href="/assets/js/47.b089bd7c.js"><link rel="prefetch" href="/assets/js/48.d1436f7a.js"><link rel="prefetch" href="/assets/js/49.a174fba0.js"><link rel="prefetch" href="/assets/js/5.780ad7e3.js"><link rel="prefetch" href="/assets/js/50.18fc3240.js"><link rel="prefetch" href="/assets/js/51.76715a85.js"><link rel="prefetch" href="/assets/js/52.08f7eb24.js"><link rel="prefetch" href="/assets/js/53.e6230a91.js"><link rel="prefetch" href="/assets/js/54.f0cdd834.js"><link rel="prefetch" href="/assets/js/55.c24858ef.js"><link rel="prefetch" href="/assets/js/56.ee51e524.js"><link rel="prefetch" href="/assets/js/57.dd385ae8.js"><link rel="prefetch" href="/assets/js/58.9ad6ea89.js"><link rel="prefetch" href="/assets/js/59.c08ecfda.js"><link rel="prefetch" href="/assets/js/6.cee5b248.js"><link rel="prefetch" href="/assets/js/60.75e0eee8.js"><link rel="prefetch" href="/assets/js/61.3a226ab8.js"><link rel="prefetch" href="/assets/js/62.01a2bf4b.js"><link rel="prefetch" href="/assets/js/63.8c76681d.js"><link rel="prefetch" href="/assets/js/64.db33256b.js"><link rel="prefetch" href="/assets/js/65.2e1ebaab.js"><link rel="prefetch" href="/assets/js/66.e094042d.js"><link rel="prefetch" href="/assets/js/67.dbaea1c1.js"><link rel="prefetch" href="/assets/js/68.e235e7aa.js"><link rel="prefetch" href="/assets/js/69.4172339e.js"><link rel="prefetch" href="/assets/js/7.6e9c4628.js"><link rel="prefetch" href="/assets/js/70.b7584039.js"><link rel="prefetch" href="/assets/js/71.f49e21cb.js"><link rel="prefetch" href="/assets/js/72.968c2e04.js"><link rel="prefetch" href="/assets/js/73.72c69fef.js"><link rel="prefetch" href="/assets/js/74.f1f00f31.js"><link rel="prefetch" href="/assets/js/75.849d225f.js"><link rel="prefetch" href="/assets/js/76.cf2cfd7f.js"><link rel="prefetch" href="/assets/js/77.927cbb1b.js"><link rel="prefetch" href="/assets/js/78.0e032591.js"><link rel="prefetch" href="/assets/js/79.30db201e.js"><link rel="prefetch" href="/assets/js/8.f6bc7e45.js"><link rel="prefetch" href="/assets/js/80.9c3e2106.js"><link rel="prefetch" href="/assets/js/81.b5a3857b.js"><link rel="prefetch" href="/assets/js/9.803a3433.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1ba410de.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/GL1.png" alt="Gocifer's blog" class="logo"> <span class="site-name can-hide">Gocifer's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🐧  Linux 学习" class="dropdown-title"><a href="/Linux/" class="link-title">🐧  Linux 学习</a> <span class="title" style="display:none;">🐧  Linux 学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Linux 基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/f354e6/.html" class="nav-link">常用命令</a></li><li class="dropdown-subitem"><a href="/pages/f354e6/.html" class="nav-link">基础原理</a></li><li class="dropdown-subitem"><a href="/pages/f354e6/.html" class="nav-link">基础服务</a></li><li class="dropdown-subitem"><a href="/pages/f354e6/.html" class="nav-link">疑难杂症</a></li></ul></li><li class="dropdown-item"><h4>Linux 提高</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/LinuxAdvanced/" class="nav-link">《GTech：Linux&amp;Unix 运维》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《GTech：Linux&amp;Unix 编程》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《GTech：Linux&amp;Unix 进阶》</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🕸️  网络·计算·安全" class="dropdown-title"><a href="/Linux/" class="link-title">🕸️  网络·计算·安全</a> <span class="title" style="display:none;">🕸️  网络·计算·安全</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/LinuxAdvanced/" class="nav-link">《GTech：交换与路由》</a></li><li class="dropdown-item"><!----> <a href="/note/es6/" class="nav-link">《GTech：网络安全》</a></li><li class="dropdown-item"><!----> <a href="/note/es6/" class="nav-link">《GTech：物联网》</a></li><li class="dropdown-item"><!----> <a href="/note/es6/" class="nav-link">《GTech：云计算》</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🌩️  云原生" class="dropdown-title"><a href="/Linux/" class="link-title">🌩️  云原生</a> <span class="title" style="display:none;">🌩️  云原生</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/LinuxAdvanced/" class="nav-link">《GCNCF：CNCF Conf 会议摘录》</a></li><li class="dropdown-item"><!----> <a href="/note/es6/" class="nav-link">《GCNCF：Serverless》 </a></li><li class="dropdown-item"><!----> <a href="/note/es6/" class="nav-link">《GCNCF：Service Mesh》 </a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🗒  开发笔记" class="dropdown-title"><a href="/ui/" class="link-title">🗒  开发笔记</a> <span class="title" style="display:none;">🗒  开发笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">后端</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">Angular</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">Flutter</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">数据结构与算法</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">Golang 集萃</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🔪  项目与实践" class="dropdown-title"><a href="/technology/" class="link-title">🔪  项目与实践</a> <span class="title" style="display:none;">🔪  项目与实践</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="💡  杂文" class="dropdown-title"><a href="/more/" class="link-title">💡  杂文</a> <span class="title" style="display:none;">💡  杂文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="⭐  收藏" class="dropdown-title"><a href="/pages/beb6c0bd8a66cea6/" class="link-title">⭐  收藏</a> <span class="title" style="display:none;">⭐  收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">0</a></li><li class="dropdown-subitem"><a href="/pages/802a1ca6f7b71c59/" class="nav-link">软件/插件安利</a></li></ul></li><li class="dropdown-item"><h4>资源</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/pages/eee83a9211a70f9d/" class="nav-link">云原生</a></li><li class="dropdown-subitem"><a href="/pages/12df8ace52d493f6/" class="nav-link">前端/客户端</a></li><li class="dropdown-subitem"><a href="/pages/12df8ace52d493f6/" class="nav-link">服务端</a></li><li class="dropdown-subitem"><a href="/pages/12df8ace52d493f6/" class="nav-link">计算机基础知识</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="📇  索引" class="dropdown-title"><a href="/archives/" class="link-title">📇  索引</a> <span class="title" style="display:none;">📇  索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🏳️‍🌈  关于" class="dropdown-title"><a href="/about/" class="link-title">🏳️‍🌈  关于</a> <span class="title" style="display:none;">🏳️‍🌈  关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">个人简历</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">项目经历</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div> <a href="https://github.com/gocifer/GLog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/xugaoyi/image_store/blog/20200103123203.jpg"> <div class="blogger-info"><h3>Gocifer</h3> <span>
        云原生菜鸟
      </span></div></div> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🐧  Linux 学习" class="dropdown-title"><a href="/Linux/" class="link-title">🐧  Linux 学习</a> <span class="title" style="display:none;">🐧  Linux 学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Linux 基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/f354e6/.html" class="nav-link">常用命令</a></li><li class="dropdown-subitem"><a href="/pages/f354e6/.html" class="nav-link">基础原理</a></li><li class="dropdown-subitem"><a href="/pages/f354e6/.html" class="nav-link">基础服务</a></li><li class="dropdown-subitem"><a href="/pages/f354e6/.html" class="nav-link">疑难杂症</a></li></ul></li><li class="dropdown-item"><h4>Linux 提高</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/LinuxAdvanced/" class="nav-link">《GTech：Linux&amp;Unix 运维》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《GTech：Linux&amp;Unix 编程》</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">《GTech：Linux&amp;Unix 进阶》</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🕸️  网络·计算·安全" class="dropdown-title"><a href="/Linux/" class="link-title">🕸️  网络·计算·安全</a> <span class="title" style="display:none;">🕸️  网络·计算·安全</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/LinuxAdvanced/" class="nav-link">《GTech：交换与路由》</a></li><li class="dropdown-item"><!----> <a href="/note/es6/" class="nav-link">《GTech：网络安全》</a></li><li class="dropdown-item"><!----> <a href="/note/es6/" class="nav-link">《GTech：物联网》</a></li><li class="dropdown-item"><!----> <a href="/note/es6/" class="nav-link">《GTech：云计算》</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🌩️  云原生" class="dropdown-title"><a href="/Linux/" class="link-title">🌩️  云原生</a> <span class="title" style="display:none;">🌩️  云原生</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/LinuxAdvanced/" class="nav-link">《GCNCF：CNCF Conf 会议摘录》</a></li><li class="dropdown-item"><!----> <a href="/note/es6/" class="nav-link">《GCNCF：Serverless》 </a></li><li class="dropdown-item"><!----> <a href="/note/es6/" class="nav-link">《GCNCF：Service Mesh》 </a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🗒  开发笔记" class="dropdown-title"><a href="/ui/" class="link-title">🗒  开发笔记</a> <span class="title" style="display:none;">🗒  开发笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">后端</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">Angular</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">Flutter</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">数据结构与算法</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">Golang 集萃</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🔪  项目与实践" class="dropdown-title"><a href="/technology/" class="link-title">🔪  项目与实践</a> <span class="title" style="display:none;">🔪  项目与实践</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="💡  杂文" class="dropdown-title"><a href="/more/" class="link-title">💡  杂文</a> <span class="title" style="display:none;">💡  杂文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="⭐  收藏" class="dropdown-title"><a href="/pages/beb6c0bd8a66cea6/" class="link-title">⭐  收藏</a> <span class="title" style="display:none;">⭐  收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8143cc480faf9a11/" class="nav-link">0</a></li><li class="dropdown-subitem"><a href="/pages/802a1ca6f7b71c59/" class="nav-link">软件/插件安利</a></li></ul></li><li class="dropdown-item"><h4>资源</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/pages/eee83a9211a70f9d/" class="nav-link">云原生</a></li><li class="dropdown-subitem"><a href="/pages/12df8ace52d493f6/" class="nav-link">前端/客户端</a></li><li class="dropdown-subitem"><a href="/pages/12df8ace52d493f6/" class="nav-link">服务端</a></li><li class="dropdown-subitem"><a href="/pages/12df8ace52d493f6/" class="nav-link">计算机基础知识</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="📇  索引" class="dropdown-title"><a href="/archives/" class="link-title">📇  索引</a> <span class="title" style="display:none;">📇  索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🏳️‍🌈  关于" class="dropdown-title"><a href="/about/" class="link-title">🏳️‍🌈  关于</a> <span class="title" style="display:none;">🏳️‍🌈  关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">个人简历</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">项目经历</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div> <a href="https://github.com/gocifer/GLog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>序言</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux 基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Linux 网络管理</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/8ad60a/" class="sidebar-link">个人代理</a></li><li><a href="/pages/431b19/" class="sidebar-link">酸酸乳</a></li><li><a href="/pages/484276/" class="sidebar-link">网络小工具</a></li><li><a href="/pages/415a31/" class="sidebar-link">host</a></li><li><a href="/pages/f354e6/" aria-current="page" class="active sidebar-link">iptables</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/f354e6/#介绍" class="sidebar-link">介绍</a></li><li class="sidebar-sub-header"><a href="/pages/f354e6/#四种状态" class="sidebar-link">四种状态</a></li><li class="sidebar-sub-header"><a href="/pages/f354e6/#结构" class="sidebar-link">结构</a></li><li class="sidebar-sub-header"><a href="/pages/f354e6/#常见的防火墙设置类型" class="sidebar-link">常见的防火墙设置类型</a></li><li class="sidebar-sub-header"><a href="/pages/f354e6/#流程" class="sidebar-link">流程</a></li><li class="sidebar-sub-header"><a href="/pages/f354e6/#基本用法" class="sidebar-link">基本用法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/f354e6/#常用规则" class="sidebar-link">常用规则</a></li><li class="sidebar-sub-header"><a href="/pages/f354e6/#常见目标操作" class="sidebar-link">常见目标操作</a></li><li class="sidebar-sub-header"><a href="/pages/f354e6/#常用的iptables命令选项" class="sidebar-link">常用的iptables命令选项</a></li><li class="sidebar-sub-header"><a href="/pages/f354e6/#常用的iptables命令条件" class="sidebar-link">常用的iptables命令条件</a></li><li class="sidebar-sub-header"><a href="/pages/f354e6/#常用规则示例" class="sidebar-link">常用规则示例</a></li><li class="sidebar-sub-header"><a href="/pages/f354e6/#常见的扩展条件类型" class="sidebar-link">常见的扩展条件类型</a></li><li class="sidebar-sub-header"><a href="/pages/f354e6/#扩展规则示例" class="sidebar-link">扩展规则示例</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/f354e6/#规则管理" class="sidebar-link">规则管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/f354e6/#永久保存" class="sidebar-link">永久保存</a></li><li class="sidebar-sub-header"><a href="/pages/f354e6/#查看当前规则" class="sidebar-link">查看当前规则</a></li></ul></li></ul></li><li><a href="/pages/d5d045/" class="sidebar-link">ssh 使用</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Shell 编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>操作系统杂谈</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>虚拟化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>内核初探</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux GUI</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux FAQ</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"> <div class="theme-vdoing-wrapper"><div class="articleInfo-wrap" data-v-14888ed5><div class="articleInfo" data-v-14888ed5><ul class="breadcrumbs" data-v-14888ed5><li data-v-14888ed5><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-14888ed5></a></li> <li data-v-14888ed5><a href="/categories/?category=GTech%EF%BC%9ALinux%E5%9F%BA%E7%A1%80" title="分类" data-v-14888ed5>GTech：Linux基础</a></li> <li data-v-14888ed5><a href="/categories/?category=Linux%20%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86" title="分类" data-v-14888ed5>Linux 网络管理</a></li></ul> <div class="info" data-v-14888ed5><div title="作者" class="author iconfont icon-touxiang" data-v-14888ed5><a href="https://github.com/gocifer" target="_blank" title="作者" class="beLink" data-v-14888ed5>Gocifer</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-14888ed5><a href="javascript:;" data-v-14888ed5>2020-07-30</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">
          iptables
        </h1> <div class="theme-vdoing-content content__default"><h1 id="iptables"><a href="#iptables" class="header-anchor">#</a> iptables</h1> <h1 id="iptables-2"><a href="#iptables-2" class="header-anchor">#</a> iptables</h1> <p>[toc]</p> <h2 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h2> <ul><li>IPTABLES是与3.5版本Linux内核集成的IP信息包过滤系统,在redhat7.1 和centos7.1以上都内置装有。</li> <li>iptables的最大优点是它可以配置有状态的防火墙，有四种有效状态，名称分别为ESTABLISHED、INVALID、NEW和RELATED。</li> <li>iptables的另一个重要优点是，它使用户可以完全控制防火墙配置和信息包过滤。您可以定制自己的规则来满足您的特定需求，从而只允许您想要的网络流量进入系统。</li> <li>iptables是用来设置、维护和检查Linux内核的IP包过滤规则的，同时iptables是免费的，这对于那些想要节省费用的人来说十分理想，它可以代替昂贵的防火墙解决方案。</li></ul> <h2 id="四种状态"><a href="#四种状态" class="header-anchor">#</a> 四种状态</h2> <blockquote><p>iptables的最大优点是它可以配置有状态的防火墙，有四种有效状态，名称分别为ESTABLISHED、INVALID、NEW和RELATED。</p></blockquote> <ul><li>状态ESTABLISHED指出该信息包属于已建立的连接，该连接一直用于发送和接收信息包并且完全有效</li> <li>状态INVALID指出该信息包与任何已知的流或连接都不相关联，它可能包含错误的数据或头</li> <li>状态NEW意味着该信息包已经或将启动新的连接，或者它与尚未用于发送和接收信息包的连接相关联</li> <li>状态RELATED表示该信息包正在启动新连接，以及它与已建立的连接相关联。</li></ul> <h2 id="结构"><a href="#结构" class="header-anchor">#</a> 结构</h2> <blockquote><p>iptables有四张表raw、mangle、nat、filter，都有独立的相应链表。</p></blockquote> <ul><li>状态跟踪表(raw)
<ul><li>prerouting</li> <li>output</li></ul></li> <li>包标记表(mangle)
<ul><li>prerouting</li> <li>postrouting</li> <li>input</li> <li>output</li> <li>forward</li></ul></li> <li>地址转换表(nat)
<ul><li>prerouting</li> <li>postrouting</li> <li>output</li></ul></li> <li><strong>过滤表(filter)</strong> <ul><li>INPUT</li> <li>FORWARD</li> <li>OUTPUT</li></ul></li></ul> <h2 id="常见的防火墙设置类型"><a href="#常见的防火墙设置类型" class="header-anchor">#</a> 常见的防火墙设置类型</h2> <p>根据防火墙保护的对象不同，防火墙可以分为主机型防火墙与网络型防火墙</p> <ul><li><p>主机型防火墙，主要保护的是服务器本机（过滤威胁本机的数据包）。</p></li> <li><p>网络防火墙，主要保护的是防火墙后面的其他服务器，如web服务器、FTP服务器等。</p></li></ul> <h2 id="流程"><a href="#流程" class="header-anchor">#</a> 流程</h2> <p>按照规则链内匹配顺序匹配</p> <ul><li>顺序匹配，匹配即停止</li> <li>若无任何匹配，按照该链的默认规则匹</li></ul> <h2 id="基本用法"><a href="#基本用法" class="header-anchor">#</a> 基本用法</h2> <blockquote><p>iptables  [-t 表名] 选项 [链名（大写）] 条件 [-j 目标操作(大写）]</p></blockquote> <h3 id="常用规则"><a href="#常用规则" class="header-anchor">#</a> 常用规则</h3> <ul><li>可以不指定表，默认为filter表</li> <li>可以不指定链，默认为对应表的所有链</li> <li>除非设置默认策略，否则必须指定匹配条件</li> <li>选项／链名用大写字母／目标操作用大写字母，其余都小写</li></ul> <h3 id="常见目标操作"><a href="#常见目标操作" class="header-anchor">#</a> 常见目标操作</h3> <ul><li>ACCEPT：允许通过/放行</li> <li>DROP：直接丢弃，不给出任何回应</li> <li>REJECT：拒绝过，必要时会给出提示</li> <li>LOG：记录日志，然后传给下一条规则</li></ul> <h3 id="常用的iptables命令选项"><a href="#常用的iptables命令选项" class="header-anchor">#</a> 常用的iptables命令选项</h3> <div style="border:black;"><table><tr><td>class</td> <td>option</td> <td>function</td></tr> <tr><td rowspan="2">ADD</td> <td>-A</td> <td>add a rule from the end</td></tr> <tr><td>-I</td> <td>add a rule from the front</td></tr> <tr><td rowspan="3">CHECK</td> <td>-L</td> <td>list all the rules</td></tr> <tr><td>-n</td> <td>display the address and port as num</td></tr> <tr><td>--line-numbers</td> <td>display the line number</td></tr> <tr><td rowspan="2">DELETE</td> <td>-D</td> <td>delete the selected order rules</td></tr> <tr><td>-F</td> <td>clear all the rules</td></tr> <tr><td rowspan="2">OTHER</td> <td>-P</td> <td>set the default rule for selected chain</td></tr> <tr><td>-X</td> <td> 清除预设表filter中使用者自定链中的规则（清除默认规则）</td></tr></table></div> <h3 id="常用的iptables命令条件"><a href="#常用的iptables命令条件" class="header-anchor">#</a> 常用的iptables命令条件</h3> <table><thead><tr><th>参数</th> <th>作用</th></tr></thead> <tbody><tr><td>-s</td> <td>匹配来源地址IP/MASK，加叹号“!”表示除这个IP外</td></tr> <tr><td>-d</td> <td>匹配目标地址</td></tr> <tr><td>-i网卡名称</td> <td>匹配从这块网卡流入的数据</td></tr> <tr><td>-o网卡名称</td> <td>匹配从这块网卡流出的数据</td></tr> <tr><td>-p</td> <td>匹配协议，如TCP、UDP、ICMP</td></tr> <tr><td>--dport num</td> <td>匹配目标端口号</td></tr> <tr><td>--sport num</td> <td>匹配来源端口号</td></tr></tbody></table> <h3 id="常用规则示例"><a href="#常用规则示例" class="header-anchor">#</a> 常用规则示例</h3> <h4 id="添加新规则"><a href="#添加新规则" class="header-anchor">#</a> 添加新规则</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>#iptables -t filter -A INPUT -p tcp -j ACCEPT   //允许接收tcp协议进来的数据包
(在表filter的INPUT链中追加规则)(-A末尾追加这条规则）

#iptables -I INPUT -p utp -j ACCEPT     //允许接收udp协议进来的数据包
(没写表名时，默认是指filter)(在INPUT规则表中首行插入这条规则）

#iptables-I INPUT 2 -p icmp -j ACCEPT   //允许接收icmp协议进来的数据包
(没写表名时，默认是指filter)(在INPUT规则表中第2行插入这条规则）
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="查看规则"><a href="#查看规则" class="header-anchor">#</a> 查看规则</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>#iptables -nL -t nat   //查看nat的全部规则表

#iptables -nL POSTROUTING -t nat //查看nat表中POSTROUTING链的规则表

#iptables -L POSTROUTING -t nat --line-numbers //以规则序号的方式查看
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="删除规则"><a href="#删除规则" class="header-anchor">#</a> 删除规则</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>#iptables -D INPUT 1 -t filter //删除表filter中INPUT链的第1条规则（-t filter没写时，默认为filter表）

# iptables -D POSTROUTING 2 -t nat  //删除表nat中POSTROUTING链中的第2条规则
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="清空规则"><a href="#清空规则" class="header-anchor">#</a> 清空规则</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>#iptables -F //默认为filter表

#iptables -t nat -F
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="设置默认规则"><a href="#设置默认规则" class="header-anchor">#</a> 设置默认规则</h4> <blockquote><ul><li>当用户添加的规则都不匹配时，为匹配默认规则</li> <li>所有链的始默认规则均为ACCEPT（接收状态）</li> <li>通过-P选项可重置默认规则，常用两种状态ACCEPT或DROP(不可设置reject)</li></ul></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>#iptable -t nat -P POSTROUTING DROP        //将nat表中POSTROUTING链默认规则设置为DROP（弃包状态）
#iptables -t filter -P INPUT ACCEPT
//将filter表中INPUT链默认规则设置为ACCEPT（接收状态）
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="常见的扩展条件类型"><a href="#常见的扩展条件类型" class="header-anchor">#</a> 常见的扩展条件类型</h3> <blockquote><p>前提条件：有对应的防火墙模块支持</p></blockquote> <p>基本用法：</p> <blockquote><p><code>-m 扩展模块 --扩展条件 条件值</code></p></blockquote> <div><tr><td>class</td> <td>option</td> <td>function</td></tr> <tr><td rowspan="6">extension</td> <td>status</td> <td>-m state --state value</td></tr> <tr><td>mac</td> <td>-m mac --mac-source value</td></tr> <tr><td rowspan="2">multiport</td> <td>-m multiport --sport sourceport</td></tr> <tr><td>-m multiport --dport des port</td></tr> <tr><td rowspan="2">ip range</td> <td>-m iprange --src-range a,b,c:d</td></tr> <tr><td>-m iprange --dst-range a,b,c:d</td></tr></div> <p>eg：-m mac --mac-source 00:0D:33:88:BC:66</p> <h3 id="扩展规则示例"><a href="#扩展规则示例" class="header-anchor">#</a> 扩展规则示例</h3> <ul><li>拒绝某主机的访问，锁定该主机的MAC地址，这样不管变成什么IP都无法访问本机</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>#iptables -A INPUT -m mac --mac-source 00:0D:33:88:BC:66 -j DROP 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>过滤无效的数据包</li></ul> <p>假设有人进入了服务器，或者有病毒木马程序，它可以通过22，80端口像服务器外传送数据。
它的这种方式就和我们正常访问22，80端口区别。它发向外发的数据不是我们通过访问网页请求而回应的数据包。</p> <p>下面要禁止这些没有通过请求回应的数据包，统统把它们堵住掉:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>iptables -A OUTPUT -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>iptables 提供了一个参数 是检查状态的，下面我们来配置下 22 和 80 端口，防止无效的数据包。</p> <ul><li>利用iptables，我们可以对日常用到的服务项进行安全管理，比如设定只能通过指定网段、由指定网口通过SSH连接本机</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>iptables -A INPUT -i eth0 -p tcp -s 192.168.100.0/24 --dport 22 -m state --state NEW,ESTABLESHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>若要支持由本机通过SSH连接其他机器，由于在本机端口建立连接，因而还需要设置以下规则</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>iptables -A INPUT -i eth0 -p tcp -s 192.168.100.0/24 --dport 22 -m state --state ESTABLESHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 22 -m state --state NEW,ESTABLISHED -j ACCEPT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>类似的，对于HTTP/HTTPS(80/443)、pop3(110)、rsync(873)、MySQL(3306)等基于tcp连接的服务，也可以参照上述命令配置。</p> <ul><li>一条规则开放多个端口</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>#iptables -A INPUT -p tcp -m muliport -dport 21:23,25,80,110,16500:16800 -j ACCEPT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>//先指定大的协议如tcp，然后再指定扩展协议
//21:23指21到23间的所有端口，16500：16800同理,不连续的用,分开</p> <ul><li>功能：根据IP范围指定可以访问本机相关端口的IP段（例如SSH远程登陆本机）</li></ul> <blockquote><p>先写允许访问的IP段，然后再写禁止IP段</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>#iptables -A INPUT -p tcp -dport 22 -m iprange --src-range 192.168.8.20-192.168.8.60 -j ACCEPT 
//先写允许20－60间的主机可以通过22端口远程访问本机
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>#ptables -A INPUT -p tcp --dport 22 -s 92.168.4.0/24 -j DROP
//当进来的IP不符合第一条规则时，会开始中匹配第二条，就在第二条上执行禁止4.0／24网段的访问。相当于只允许第一条的人访问。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>网口转发配置</li></ul> <p>对于用作防火墙或网关的服务器，一个网口连接到公网，其他网口的包转发到该网口实现内网向公网通信，假设eth0连接内网，eth1连接公网，配置规则如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>iptables -A FORWARD -i eth0 -o eth1 -j ACCEPT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>端口转发配置</li></ul> <p>对于端口，我们也可以运用iptables完成转发配置：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>iptables -t nat -A PREROUTING -p tcp -d 192.168.102.37 --dport 422 -j DNAT --to 192.168.102.37:22
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>通过iptables实现局域网内不同网段间的两台主机的互联网共享.</li></ul> <p>假如A主机IP192.168.0.5／192.168.2.5（双网卡）可以上网，B主机IP192.168.2.100不能上网</p> <p>首先确保A和B要能相互ping通，A主机能上网</p> <p>然后把B主机的IP网关设置成192.168.2.5，DNS设置成和主机A的DNS一样</p> <p>开始添加修改主机A的iptables规则</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#echo 0 &gt; /proc/sys/net/ipv4/ip_forward
//echo 'net.ipv4.ip_forward=1'&gt;&gt;/etc/sysctl.conf

//修改/etc/sysctl.conf配置文件，可以实现永久有效规则

//首先开启主机A的路由转发功能

#iptables -t nat -A POSTROUTING -s 192.168.2.100 -p tcp --dport 80 -j SNAT --to-source 192.168.0.5

//将主机B访问主机A的80端口上的数据转发到主机A另一个能访问外网的网卡上ip是192.168.0.5，
其中-p tcp --dport 80 可以不写，就变成访问A的所有端口数据都转到ip为192.168.0.5的网卡上，借由这个网卡再加上路由功能转的开启，从而实现连接外网。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>实现A可以ping能B，B无法ping通A（只是回应拒绝访问）</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>#iptables -A INPUT -p icmp --icmp-type echo-request -j REJECT
//在主机A上添加上面规则
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>实现禁止路由访问代理服务器后面的服务器主机</li></ul> <p>在代理服务器开启路由转发的前提下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># iptables -I FORWARD -s 192.168.2.200 -p tcp --dport 80 -j DROP

//192.168.2.200是要访问server的客户机，当客户机通过server访问80转发端口时丢弃数据包

#iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

//如上例，添加一条入站规则：对进来的包的状态进行检测。已经建立tcp连接的包以及该连接相关的包允许通过！

//ESTABLISHED：已建立的链接状态。RELATED：该数据包与本机发出的数据包有关。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>防止骇客使用洪水攻击</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>#iptables -A INPUT -m limit --limit 3/hour

//用来比对某段时间内封包的平均流量，上面的例子是用来比对：每小时平均流量是
否超过一次 3 个封包。 除了每小时平均次外，也可以每秒钟、每分钟或每天平均一次，
默认值为每小时均一次，参数如后：/second、/minute、/day。除了进行封数量的
比对外，设定这个参数也会在条件达成时，暂停封包的比对动作，以避免因骇客使用洪水
攻击法，导致服务被阻断
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>#iptables -A INPUT -p tcp --dport 80 -m limit --limit 25/minute --limit-burst 100 -j ACCEPT

//--litmit-burst 100 指示当总连接数超过100时，启动 litmit/minute 限制
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>配置web流量均衡
我们可以将一台服务器作为前端服务器，利用iptables进行流量分发，配置方法如下：</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>iptables -A PREROUTING -i eth0 -p tcp --dport 80 -m state --state NEW -m nth --counter 0 --every 3 --packet 0 -j DNAT --to-destination 192.168.1.101:80
iptables -A PREROUTING -i eth0 -p tcp --dport 80 -m state --state NEW -m nth --counter 0 --every 3 --packet 0 -j DNAT --to-destination 192.168.1.102:80
iptables -A PREROUTING -i eth0 -p tcp --dport 80 -m state --state NEW -m nth --counter 0 --every 3 --packet 0 -j DNAT --to-destination 192.168.1.103:80
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>以上配置规则用到nth扩展模块，将80端口的流量均衡到三台服务器。</p> <ul><li>将丢弃包情况记入日志</li></ul> <p>使用LOG目标和syslog服务，我们可以记录某协议某端口下的收发包情况。拿记录丢包情况举例，可以通过以下方式实现。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>首先自定义一个chain：
iptables -N LOGGING

其次将所有接收包导入LOGGING chain中：
iptables -A INPUT -j LOGGING

然后设置日志前缀、日志级别：
iptables -A LOGGING -m limit --limit 2/min -j LOG --log-prefix &quot;IPTables Packet Dropped: &quot; --log-level 7
最后将包倒向DROP，将包丢弃：

iptables -A LOGGING -j DROP
另可以配置syslog.conf文件，指定iptables的日志输出。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="规则管理"><a href="#规则管理" class="header-anchor">#</a> 规则管理</h2> <ul><li>iptables的默认配置文件路径：/etc/sysconfig/iptables</li></ul> <h3 id="永久保存"><a href="#永久保存" class="header-anchor">#</a> 永久保存</h3> <p>当你删除、添加规则后，这些更改并不能永久生效，这些规则很有可能在系统重启后恢复原样。为了让配置永久生效，根据平台的不同，具体操作也不同。</p> <ul><li>Ubuntu</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>首先，保存现有的规则：
iptables-save &gt; /etc/iptables.rules
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>然后新建一个bash脚本，并保存到/etc/network/if-pre-up.d/目录下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#!/bin/bash
iptables-restore &lt; /etc/iptables.rules
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这样，每次系统重启后iptables规则都会被自动加载。</p> <blockquote><p>注意：不要尝试在.bashrc或者.profile中执行以上命令，因为用户通常不是root，而且这只能在登录时加载iptables规则。</p></blockquote> <ul><li>CentOS, RedHat</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code># 保存iptables规则
service iptables save
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="查看当前规则"><a href="#查看当前规则" class="header-anchor">#</a> 查看当前规则</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>cat  /etc/sysconfig/iptables
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><hr> <blockquote><p>referred from:https://blog.csdn.net/cbuy888/article/details/80383770</p></blockquote></div></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/gocifer/GLog/edit/master/docs/GTech：Linux基础/02.Linux 网络管理/05.iptables.md" target="_blank" rel="noopener noreferrer">编辑</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2020/07/31, 11:07:00</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/415a31/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">
        host
      </div></a> <a href="/pages/d5d045/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">
        ssh 使用
      </div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/415a31/" class="prev">host</a></span> <span class="next"><a href="/pages/d5d045/">ssh 使用</a>
        →
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/GTech%EF%BC%9ALinux%E5%9F%BA%E7%A1%80/04.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%9D%82%E8%B0%88/07.Linux-4.4-x86_64%20%E5%86%85%E6%A0%B8%E9%85%8D%E7%BD%AE/"><div></div></a> <span></span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/9b58a3/"><div>index</div></a> <span>07-30</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/98238b/"><div>基本命令</div></a> <span>07-30</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div> </main></div> <div class="footer"><div class="icons"><a href="mailto:blinderjay@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/gocifer" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
     | Copyright © 2020-2020
    <span>gocifer | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----></div><div class="global-ui"><!----><div></div></div></div>
    <script src="/assets/js/app.5bb0b44e.js" defer></script><script src="/assets/js/2.717babc4.js" defer></script><script src="/assets/js/32.442e6531.js" defer></script>
  </body>
</html>